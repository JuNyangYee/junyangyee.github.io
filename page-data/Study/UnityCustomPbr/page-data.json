{"componentChunkName":"component---src-templates-blog-template-js","path":"/Study/UnityCustomPbr/","result":{"data":{"cur":{"id":"2cba46c0-13ea-5259-b303-e1e919eaf179","html":"<p><strong>모바일에서 사용 가능한 유니티 커스텀 섭스턴스 PBR 쉐이더 만들기</strong></p>\n<blockquote>\n<p>군생활 중, NDC 2019 발표를 보면서 단순 정리한 내용입니다.<br>\n노션에 작성했던 내용을 블로그로 옮겨 작성해, 가독성에 문제가 있을 수 있습니다.</p>\n<p><em>※주의 : 본 내용은 아주 기술적인 이야기는 아니며, 기술보다는 꼼수를 이용한 문제해결 이야기입니다.</em><br>\n<em>약 38:35 정도까지 작성되었습니다.</em></p>\n</blockquote>\n<div style=\"position: relative; width: 100%; padding-bottom: 56.25%\">\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/hC62O9NGXEw?si=-eYCun2EHZMbX3gR\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen style=\"position: absolute; width:100%; height: 100%;\"></iframe>\n</div>\n<div style=\"margin-top: 12px\"> </div>\n<p><a href=\"http://ndcreplay.nexon.com/NDC2019/sessions/NDC2019_0006.html#k%5B%5D=pbr\">▶ NDC Replay - 발표 자료 링크</a></p>\n<hr>\n<h3 id=\"유니티-pbr\" style=\"position:relative;\"><a href=\"#%EC%9C%A0%EB%8B%88%ED%8B%B0-pbr\" aria-label=\"유니티 pbr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유니티 PBR</h3>\n<ul>\n<li><strong>리니어 스페이스와 감마 스페이스</strong>\n<ul>\n<li>사실 리니어 스페이스가 맞는 값</li>\n<li>하지만 어두운 곳에 민감한 사람 눈은 이것을 선형적으로 인지하지 않는다.</li>\n<li>이것을 감마 코렉션 (2.2제곱)하여 선형적으로 보이게끔 한 것</li>\n<li>Unity ColorSpace Default Setting : <strong>Gamma</strong></li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACYUlEQVQoz3WT/UtTURjH979G/RAUvWhBiSwtkVJIqAiMqDWn4hR3NV82t+WmGOnuZS+6Od3mXrxO0ek2t7s394lzRMugL3w5zznPfb734XueY2q1WtQbDWq1GrWaQaVakWu9XqdarWIYxvW5OBO8uLiQuUajgUC73ZZrs9nEVC6XCYVDqJpGNLZNMBgioGrEtuMyTiZThEIRgsEgyWSS6FaUdDrN+sYG8Xj8pmCrhUn8TaBmFPF5xpiZHSWkLZFNaczO2nC77aQSGvPuOZwry/jWf16LXNVe4YZg4USn52Unz3rMWKzvmf9uoau/h76hfrxeO++GB/lst2Cd/Hpph/HHlkqlgrCu9bfg8VGO7q67dJufYvnyGsfUJx513uFF7z18XjsDg88xv3qM1TIgvxdiwjPh45WvNwQN4xyfbwq3Z5Kt8Ar6fgyve5K1FYX8QYKZmRGmlTE21DX+h2azhandvhQsnh4QiSzQpsleYo3w5hKVepnzc51f63M43VOUjTpOv4vj40PZTa1ek9MhOhSQHYqxEJeUzcQYGf2Auhll0TWKbewj44qCsjjDwvwIe6ktWRQO+dH1DJVKlVKpRLFYpFQuS1ExWqajo0MKhVOSyW36+h5i7u3AYnnDxPgw9x/couPJbeZmbXyzDLGwOI7N+pZ8XufsrEihUJA8OTmRzOfzmBKJBIKpVApdP2B/f59cTiedzpDLZslmsjIW+Z2dHRlHIhGcLheeH16W/X78q6tyTnd3dzGpqkogEEDTNAJqALH/l5qmyrygKPT7/UzY7UwrDqYdDhyKgsfrlY/jNyRoBxi2FCm4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img01\"\n        title=\"UnitySubstance_img01\"\n        src=\"/static/526f7adfd00a610fdf43b17053457f67/37523/UnitySubstance_img01.png\"\n        srcset=\"/static/526f7adfd00a610fdf43b17053457f67/e9ff0/UnitySubstance_img01.png 180w,\n/static/526f7adfd00a610fdf43b17053457f67/f21e7/UnitySubstance_img01.png 360w,\n/static/526f7adfd00a610fdf43b17053457f67/37523/UnitySubstance_img01.png 720w,\n/static/526f7adfd00a610fdf43b17053457f67/302a4/UnitySubstance_img01.png 1080w,\n/static/526f7adfd00a610fdf43b17053457f67/08037/UnitySubstance_img01.png 1379w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJUlEQVQoz42SzUsUYRzH52/p2KEXSgQFsbeTEhTVTbdLoUVdTDtEdAq6FVEQ0SlIwiLMakPNzMXdFXJnRndnbZ1ZNlaSfbFcd2fHedv5xOyuptahH3z4Pgzf5/MMM4/gui7VahXDMKhUKpimiT+e5/034Gdjj2BZFuFImEg0wmx4lmV1uS6s1Wr1gp+1PZvxatQNjaObzxtrgX9Ns+A4LqZpYdsWuq5jGCaW7fhKHGDT9XBre95wy247FvGUTDqboWJUERfn+L6iEk8tomaz5H6uIYkzZF14/jXJpJwgtemhmt6OT8QfoWWVGbh1iWs3B5mT5llSRaJzr+jp6+HyjSE+hiPExAneT73hdO8FXrwboewYSCkFx7G3pdtCxy5z9XqAQ+0dXOy/wsjoMLI4SvfZLtqOd3I+EOD16FNeDt/nYOsB7j68h7aq8mNlAce2/hZW9V8MDXTTduwoLR1H6Os/xXjwMYHedlraDtPavp87t88xM/GMk5376DpzggePBpkaf7It80fwr4n/p3W9gjg/xZfpt4RCY0TDQTKZJWRxmlAoSDQaRIzNkFtNE5c+82lyjOjsBzLpOJZl16+bj1AoFPApFotsbOiUShVKpTLlcpVcrkC+sNbI/Br5fLHOerPj99fXN9hy+AjpdJotVFVF89HU+jqZTJJQEiiKgpJUSCTipFLf0DSt3mmgsdMhiKLIfCyGn5Ik7UKW5V0sNHNvbye/ASuwBKmtf+0rAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img02\"\n        title=\"UnitySubstance_img02\"\n        src=\"/static/68eaafa13ff6cd6b0ace1546f4c29ca7/37523/UnitySubstance_img02.png\"\n        srcset=\"/static/68eaafa13ff6cd6b0ace1546f4c29ca7/e9ff0/UnitySubstance_img02.png 180w,\n/static/68eaafa13ff6cd6b0ace1546f4c29ca7/f21e7/UnitySubstance_img02.png 360w,\n/static/68eaafa13ff6cd6b0ace1546f4c29ca7/37523/UnitySubstance_img02.png 720w,\n/static/68eaafa13ff6cd6b0ace1546f4c29ca7/302a4/UnitySubstance_img02.png 1080w,\n/static/68eaafa13ff6cd6b0ace1546f4c29ca7/0931d/UnitySubstance_img02.png 1373w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADE0lEQVQoz02SXU9bBQCGz2/wVhMdziIDxkcrDizB8tW1BdFuHXQDP4bFrqRhzCxFzaJjM9PNTJlOwZmJGjJZYujmKFBH1wXc2nK6Au1pC0UXEjO3xGkWzqHFAI+hV77Jc/PkzXv1ChsbG6TTqyiKjKIoyPJKlkwmnXWrq0oWWZZZW8uQzqRZX19HVhRWVrZ6GTY2N9na2dzcRNgSy8t/kEymWEimWFxMEQ7PspT6HUlKkEgskkgsIIphllJ3kWIJ/rx3j3hcIhQM8OD+ff4fYe3fDG7PtwxfOY979CJDw18xMvY1t8UJRkYvMvDdSb7/8VO+6D/F4KXTeG9eJrb0G4FogplECn9IJCQtMD0b5cHf/yAoyiNs9nL2tKjQ6p5EteMxnF1qzvRZcTiraN6fR4O5gCL1E3R37+LEKSP9l3/Cfuw99BYj2koNh1xHeOfzC4hSHCGdXmHwfCfNlkperH8BY1M1zg49/p9P8sNAF44OI23t+3B0H+To4VcYH3YxdNXNa047xZo8TA069CYdXb29zCYXENYyMna7mcLSbWjKC6jWaykqfZqzHzk4/oENXW0xdYYKDtr3U6tXc+ZDGxeGvuH5qjJU+TnUGHVUVKnRGXVEpCiCLD/CeaiR2pp8tj3zOHmFObRZK+jv6+T9d1vZu6ecYk0uz1UU8FZ7Hf2fvUnflx/zkrmGZwtzUOU/Rb1Ri+OIjfBcGOHhw79wvW2ixVJMiSaXnSXbsb1RycC5TnqONvF6m4ZKXQm7tIV0tFdz7vSrDAyexdXroLxKTUHJdnY3VdNz4jAB8RbC8vJdWvaWYahXUVdXhGn3Tva9XMTxnmZarVoaDbmYGspoaizFatHgchr4pO8YXa4DmK0GLAeMtLabsXc34/VdQ0ilUvhvTODzjeEZdeMdv8Lk9VGmpibx+SbwTXrweNyMeUay/qbfy+3ANFPTPn65Psa49xq/3vIzNX2DWGweIRKJEI1JSPGtEyeJxeKI4h2CoRlmZsKEwxHE8J0soZCY9YFAkGAwxPx8lLiUIBaVkKQ4c3Pz/Afgo2BWSi+F8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img03\"\n        title=\"UnitySubstance_img03\"\n        src=\"/static/933ced8a42695400058a74e073d1efde/37523/UnitySubstance_img03.png\"\n        srcset=\"/static/933ced8a42695400058a74e073d1efde/e9ff0/UnitySubstance_img03.png 180w,\n/static/933ced8a42695400058a74e073d1efde/f21e7/UnitySubstance_img03.png 360w,\n/static/933ced8a42695400058a74e073d1efde/37523/UnitySubstance_img03.png 720w,\n/static/933ced8a42695400058a74e073d1efde/302a4/UnitySubstance_img03.png 1080w,\n/static/933ced8a42695400058a74e073d1efde/1dbe8/UnitySubstance_img03.png 1374w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p><strong>유니티와 섭페를 비교해보며 알 수 있었던 것</strong></p>\n<ul>\n<li>유니티 감마는 물론이고 리니어도 섭스턴스 페인터와 동일하지 않다.</li>\n<li>결과값이 다르게 나오는 걸 보면 서로서로 구현도 다르다는 것을 알 수 있다.\n<ul>\n<li>즉, 물리기반 쉐이더가 사실은 물리적으로 완벽하게 옳은 것은 아니라는 것,</li>\n<li>Physically <strong>“Based”</strong> Shader</li>\n</ul>\n</li>\n<li>물리적인 이론과 라이트모델을 고려했을 뿐, 사실은 근사값 대잔치.\n<ul>\n<li>근사값 : 정확한 건 아니지만 대충 이정도로 하니까 비슷해보이는데?</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>PBR은 리니어에서 하는게 상식이다. 그러나…</strong></p>\n<ul>\n<li>감마 상태로 아주 오래 이어져 와서 리소스가 너무 많이 쌓여 컬러 스페이스를 바꾸는 것이 부담스럽거나</li>\n<li>이미 출시가 된 상태 (라이브 중)라 컬러 스페이스를 바꿀 수 없거나</li>\n<li>컬러 스페이스를 어떻게 바꾸는지 모르거나</li>\n<li>중도 입사했는데 이미 감마상태거나</li>\n<li>등등등 ”<strong>리니어로 바꾸세요</strong>“가 안되는 상황</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACq0lEQVQoz42SW0iTYRjHd9t1eFVmTi3RXNt0aZoGUQQVnaPEAiuio4VRswNFbWaFTs0WpBelF0FBmVi4+WkIsZFZ25yHmQ3LWJiDpbL1zXn8xfeJSnf94f8+p5c/z/O8r2J6epqxsTGZ4XAYKZ6cnCQSiTAxMcHU1NQ/lPKSnZ2dRcLMzAzzkHIKURT59Pkz3T09DP4YxO1243K5+NLfj8fjweF04PV6+er9KtcGBgbw9HkIBoMLQt9/DPLt+zfZV0jHx46PvKp/yZu3jXJ3/wNpEmkCCfqrevRFlxYF+/v6+GC34XI5CYWCjI+PEw6LspUwGYkQCgbllYjinwUhCU/rnqDRqTGVly4Kjo6OcrvkLoVXr3PuchEF+iscO1uAuaZGvhQIBDBVmTGWmrh9vxRzdTXdXZ2EQiEMJQZWxK+gyvxgUVBa5t68w8Sp1KiyslFl5ZCgTeXyjZs0WqwMDQ2Re/wES+NWE6vVodTqWBIVxS2DgUfVZmJXxVBRWT4nOP9KjU0Wtu7Zy67cPHbm5rF99y7OF15gZGRErlc9rubMxUty9+eKrnHk5CleNzRQ+ciEMnElDx5WzgmK4bDsWFvfEb1GRUJaOqvWZaLUriM2OZmfP338DgSwWq28t9tpslrp6nIv7PBuWQnxSUpMFWVzgsPDw4RFkecv61mWmIxSk0ZcWgYxa1NJSFmDp7cXv99P/qnTrN+8hY3bdrB93372HTxAbV0txfcMRCuXYyw2EhmPoJD+2K9fQzx7/oIkXTrqDTlocjaRkp6BVpdKR0cHPp+PQ/lHiVdrUGVmk5KZTVRMDPoiPffL7pGsTqL4jhH/sB+F0+lEYnt7O0JrK00WC/UNDQhCs0yHwyF/9La2NjluEQRaWgQEQcBut2G322kWmrHZbLg73fwFI0milf7v6RwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img04\"\n        title=\"UnitySubstance_img04\"\n        src=\"/static/7cedad2ddcfe87e02c82bf2f69980748/37523/UnitySubstance_img04.png\"\n        srcset=\"/static/7cedad2ddcfe87e02c82bf2f69980748/e9ff0/UnitySubstance_img04.png 180w,\n/static/7cedad2ddcfe87e02c82bf2f69980748/f21e7/UnitySubstance_img04.png 360w,\n/static/7cedad2ddcfe87e02c82bf2f69980748/37523/UnitySubstance_img04.png 720w,\n/static/7cedad2ddcfe87e02c82bf2f69980748/302a4/UnitySubstance_img04.png 1080w,\n/static/7cedad2ddcfe87e02c82bf2f69980748/f0811/UnitySubstance_img04.png 1367w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p><strong>감마에서 PBR로 퀄리티를 올리기란…</strong></p>\n<ul>\n<li>Standard 는 수많은 include로 인해 코드보기 및 변경이 힘듦</li>\n<li>수정하려면 GI 함수를 건드려야하는데 난이도가 높음</li>\n<li>또한 아티스트가 의도한 대로 아웃풋 표현이 잘 안되니 어려움</li>\n<li>그래서 Standard PBR은 과감히 포기하고 <strong>’수동으로라도 PBR 비슷하게 느낌을 내보면 어떨까’</strong></li>\n</ul>\n</li>\n<li>\n<p><strong>PBR에서 3D 아티스트는 섭스턴스 사용</strong></p>\n<ul>\n<li>섭스턴스에 Specular / Glossiness 워크플로우가 있긴 하다.</li>\n<li>하지만 <strong>Roughness / Metallic 워크플로우가 표준이자 대세</strong>. 모두 이것으로 작업.</li>\n</ul>\n</li>\n<li>\n<p><strong>섭스턴스에서 값을 바꿔가며 변화를 체크해보니…</strong></p>\n<ul>\n<li><em>Albedo / Roughness / Metallic</em> 값 변화에 따라 변하는 값이 생각보다 몇 개 없다.\n<ul>\n<li><em>Specular</em></li>\n<li><em>Cubemap</em></li>\n<li><em>Fresnel</em></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>나는 아티스트니까 눈을 믿자</strong></p>\n<ul>\n<li>어차피 PBR도 진짜 물리적으로 계산하는 것도 아닌데 (근사값)</li>\n<li><em>Albedo</em>는 <code class=\"language-text\">float3</code>니까 Luminance를 구하여 <code class=\"language-text\">float</code>로 치환하면<br>\n<em>Albedo / Metallic / Roughness</em>를 보간의 3항으로 사용 가능\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">ex<span class=\"token punctuation\">)</span> Specular <span class=\"token operator\">=</span> NdotH <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token function\">Luminance</span><span class=\"token punctuation\">(</span>Albedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nex<span class=\"token punctuation\">)</span> Fresnel <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">-</span>NdotV<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> Roughness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>이런 느낌으로 <em>Albedo</em>가 밝을때는 빛을 반사하므로 <em>Specular</em>를 더 세게 해준다거나 표면이 거칠때는 프레넬 값을 감쇠시킨다던지 계산하면 되지 않을까?</li>\n</ul>\n</li>\n<li>\n<p><strong>아티스트가 문제를 해결하는 두 가지 길</strong></p>\n<ol>\n<li>기술적으로 해결하거나 (머리가 고생)</li>\n<li>노가다로 해결하거나 (몸이 고생)\n<ul>\n<li>이번 경우 (감마 PBR)는 기술적으로 답이 안나와서 스스로 생각하기에도 조금 미친 짓을 해보기로 함</li>\n<li>물리기반 셰이더와 똑같이 보이지만 전혀 안물리기반 셰이더를 만들어보기로</li>\n<li>회사에서 내내 물리/수학 공부만 할 수 있는 상황도 아님.</li>\n<li>결과와 과정이 둘 다 중요하지만, <strong>급하면 그런거 없다.</strong></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>눈으로 보고 똑같이 만드는 것의 장점</strong></p>\n<ul>\n<li>복잡한 물리 / 수학 계산을 안해도 된다.</li>\n<li>감마든 리니어든 새로운 제3세계의 컬러스페이스든 <strong>눈으로 보고 맞추면 됨</strong></li>\n<li>HDR, 톤매핑 설정이 뭐든 간에 <strong>눈으로 맞추면 됨</strong></li>\n<li>독특한 라이팅 환경? <strong>눈으로 맞추면 됨</strong></li>\n</ul>\n</li>\n<li>\n<p><strong>일단 섭스턴스에서 모든 값을 캡쳐</strong></p>\n<ul>\n<li><em>Metallic</em>은 0과 1만 쓰는 것이 룰이지만, 혹시나 중간값을 쓰는 경우가 있을지도 모르니 보간으로 처리 (중간 값은 갭쳐에서 뺀다)</li>\n<li><em>BaseColor</em>가 0, 0.5, 1일때의 <em>Metallic</em>과 <em>Roughness</em> 값 변화에 따른<br>\n<em><strong>Specualr, Fresnel, Cubemap Reflection</strong></em> 값의 변화를 체크한다.\n<ul>\n<li>사실 PBR에서 이 세가지 리플렉션을 이렇게 따로 떨어뜨려 놓기는 애매하지만 셰이더에선 구현 편희상 따로 나눌 것이기 때문에 미리 따로 체크</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>섭스턴스에서 각 패러미터 변화별로 이미지 캡쳐</strong></p>\n<ul>\n<li><em>BaseColor</em> 가 0.5 (Gray)일 때\n<ul>\n<li>금속은 반사가 강하고 비금속은 약하다.</li>\n<li>비금속은 명암이 있지만 금속은 없다.</li>\n<li>표면이 거칠수록 반사는 흐려지고 약해진다.</li>\n<li>표면이 매끈할수록 스펙큘러가 좁아지며 밝기는 증가한다.</li>\n<li>그래프는 정확한 수치가 아니라 의식의 흐름대로…</li>\n</ul>\n</li>\n<li><em>BaseColor</em> 가 1 (White)일 때\n<ul>\n<li>비금속일 때 반사의 영향이 거의 없다.</li>\n<li>금속일때는 Diffuse가 없어서 그만큼 어두워지지만, 반사율이 높아 반사가 더 잘보인다.</li>\n<li>금속 스펙큘러는 표면의 색에 영향을 받아서 흰색일 때 굉장이 강하다.</li>\n</ul>\n</li>\n<li><em>BaseColor</em> 가 0 (Black)일 때\n<ul>\n<li>표면이 거칠면 금속은 완전 흑색이 되지만, 비금속은 완전 흑색이 되지 않는다.</li>\n<li>비금속에서는 스펙큘러가 상당히 약해진다.</li>\n<li>금속에서는 스펙큘러가 나타나지 않는다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>정리 - DIFFUSE</strong></p>\n<ul>\n<li>비금속에는 <em>Diffuse (Lambert)</em> 로 인한 명암이 생기지만 금속에는 없다.</li>\n<li>금속일때는 <em>Diffuse</em>가 없으므로 <em>BaseColor</em>는 그만큼 어두워지고 대신 반사율이 높아진다.</li>\n<li><em>BaseColor</em>가 어둡고 <em>Roughness</em>가 높아지면 금속은 <em>Diffuse</em>와 <em>Reflection</em>이 없어서 완전 흑색이 되지만, 비금속은 <em>Diffuse</em>가 있어 살짝 밝다.</li>\n</ul>\n</li>\n<li>\n<p><strong>정리 - SPECULAR</strong></p>\n<ul>\n<li><em>BaseColor</em> 색이 밝아질수록 <em>Specular</em>가 강해진다.</li>\n<li>비금속의 <em>Specular Color</em>는 흰색이고, 금속의 <em>Specular Color</em>는 <code class=\"language-text\">BaseColor (Albedo) * LightColor</code> 이다.</li>\n<li>그래서 금속의 <em>BaseColor</em>가 어두우면 <em>Specular</em>가 나타나지 않는다.</li>\n</ul>\n</li>\n<li>\n<p><strong>정리 - ROUGHNESS , FRESNEL</strong></p>\n<ul>\n<li>비금속도 매끄러우면 반사율이 조금 있다.\n<ul>\n<li><em>Roughness</em>가 0에 가까우면 미세면으로 인한 난반사가 많이 일어나지 않게 되어, 그만큼 <em>Reflection</em>이 살짝 강해지기 때문.</li>\n<li>하지만 금속만큼은 아니다.</li>\n</ul>\n</li>\n<li><em>Fresnel</em>은 금속 / 비금속 상관없이 어디에나 있다.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3 id=\"간단-pbr-개념\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8-pbr-%EA%B0%9C%EB%85%90\" aria-label=\"간단 pbr 개념 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단 PBR 개념</h3>\n<ul>\n<li>\n<p><strong>PBR 개념 간단 정리 - Energy Conservation</strong></p>\n<ul>\n<li>Diffuse &#x26; Reflection\n<ul>\n<li>빛이 물체에 닿으면 일부는 반사, 일부는 산란, 일부는 흡수\n<ol>\n<li>산란되는 녀석 = Diffuse</li>\n<li>반사되는 녀석 = Specular, Fresnel 등</li>\n<li>흡수되는 녀석 = Refraction (굴절), (뒷면에서 흡수) 투과</li>\n</ol>\n</li>\n<li>PBR에서 가장 중요한 것은 <strong>열역학 1법칙 - 에너지 보존</strong>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">Light <span class=\"token operator\">>=</span> Diffuse <span class=\"token operator\">+</span> Reflection <span class=\"token operator\">+</span> Refraction</code></pre></div>\n</li>\n<li>Albedo는 ‘반사’가 아니라 그냥 표면의 색일뿐.</li>\n<li>PBR에서는 굴절, 흡수는 생각하지 않고 크게 <strong>Diffuse</strong>와 <strong>Reflection</strong>만 생각한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>PBR 개념 간단 정리 - IBL</strong></p>\n<ul>\n<li>조금 더 사실적인 표현을 위해 Directional Light에서 빛이 오는 것이 아니라 Cubemap(EnvMap)에서 빛이  온다 (Image Based Lighting)</li>\n<li>단일 광원이 아니라 전방향 광원</li>\n<li>IBL Source는 HDR로 만들어져 있어서, 그 자체로 <strong>라이트를 포함</strong>하고 있다.\n<ul>\n<li>HDR - High Dynamic Range. 1이상의 밝기 정보를 포함.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>PBR 개념 간단 정리 - Specular</strong></p>\n<ul>\n<li>HDR 환경맵 안에 포함되어있는 1 이상의 색상정보를 광원으로 인식하고 GGX나 Beckman 방식 등으로 계산하여 <strong>환경맵의 밉맵에 그 결과값을 넣어놓는다.</strong> (엔진이 해준다)</li>\n<li>컨벌루젼 타입을 Specular (Glossy Reflection)으로 설정</li>\n<li>유니티 PBR에서의 Specular는 HDR 밉맵이 다가 아니라 Directional Light로 Specular가 추가되기도 한다.</li>\n<li>라이트로 추가된 Specular도 GGX</li>\n</ul>\n</li>\n<li>\n<p><strong>PBR 개념 간단 정리 - Metallic</strong></p>\n<ul>\n<li>메탈릭 Metallic (금속성)</li>\n<li>반사표를 보면 입사각이 90도에 가까울수록 모든 물체의 반사율이 올라감 (Fresnel)</li>\n<li>각도에 따라 변하는 비금속과 달리 금속은 입사각에 상관없이 거의 항상 위쪽 (반사율 높음)</li>\n<li>반사율이 높아지면 에너지 보존 법칙에 의하여 <strong>Diffuse가 거의 없어짐</strong></li>\n<li>금속물질은 몇몇 파장을 흡수하므로 컬러 스펙큘러가 있다.</li>\n</ul>\n</li>\n<li>\n<p><strong>PBR 개념 간단 정리 - Roughness</strong></p>\n<ul>\n<li>러프니스 Roughness (거칠기)</li>\n<li>물체표면이 거칠면 거칠수록\n<ul>\n<li>난반사 (Diffuse)가 심해지면서</li>\n<li>정반사 (Reflection)는 그만큼 약해짐 (빛의 총량은 같다)</li>\n</ul>\n</li>\n<li>Diffuse 영향 ↑, Reflection 영향 ↓</li>\n<li>반사값 변화에 가장 큰 영향을 준다. 알기 쉬움.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3 id=\"라이팅-모델\" style=\"position:relative;\"><a href=\"#%EB%9D%BC%EC%9D%B4%ED%8C%85-%EB%AA%A8%EB%8D%B8\" aria-label=\"라이팅 모델 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>라이팅 모델</h3>\n<ul>\n<li>\n<p><strong>각 엔진들의 PBR 구현 라이팅 모델</strong></p>\n<ul>\n<li>PBR에 대해서 알아보려면 라이팅모델에 대한 이해가 필수</li>\n<li>Unity Legacy\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">Disney Diffuse <span class=\"token operator\">+</span> Cook <span class=\"token function\">Torrance</span> <span class=\"token punctuation\">(</span>GGX<span class=\"token punctuation\">,</span> Smith<span class=\"token punctuation\">,</span> Schlick<span class=\"token punctuation\">)</span> Specular\n\nLambertian Diffuse <span class=\"token operator\">+</span> Simplified Cook <span class=\"token function\">Torrance</span> <span class=\"token punctuation\">(</span>GGX<span class=\"token punctuation\">,</span> Simplified KSK and Schlick<span class=\"token punctuation\">)</span> Specular</code></pre></div>\n</li>\n<li>Unity SRP LW\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">Lambertian Diffuse <span class=\"token operator\">+</span> Simplified Cook <span class=\"token function\">Torrance</span> <span class=\"token punctuation\">(</span>GGX<span class=\"token punctuation\">,</span> Simplified KSK and Schlick<span class=\"token punctuation\">)</span> Specular</code></pre></div>\n</li>\n<li>Unity SRP HD\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">기본적으로 <span class=\"token function\">Disney</span> <span class=\"token punctuation\">(</span>or Lambert<span class=\"token punctuation\">)</span> Diffuse <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>Anisotropic<span class=\"token punctuation\">)</span>GGX Specular\n인데 GI<span class=\"token punctuation\">,</span> 랜더패스 등과 엮여있음</code></pre></div>\n</li>\n<li>Unreal\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">Disney Diffuse <span class=\"token operator\">+</span> Cook <span class=\"token function\">Torrance</span> <span class=\"token punctuation\">(</span>GGX<span class=\"token punctuation\">,</span> Smith<span class=\"token punctuation\">,</span> Schlick<span class=\"token punctuation\">)</span> Specular</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>사실적인 표현을 위해 고안된 여러 라이팅 모델</strong></p>\n<ul>\n<li>Diffuse BRDF\n<ul>\n<li>Lambert</li>\n<li>Oren - Nayer</li>\n<li>Disney Diffuse</li>\n</ul>\n</li>\n<li>Reflection (Specular) BRDF\n<ul>\n<li>Phong</li>\n<li>Blinn - Phong</li>\n<li>Cook Torrance</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>BRDF? BTDF? BSDF?</strong></p>\n<ul>\n<li>Bidirectional (양방향) Reflect (반사) Distribution (분포) Function (함수)\n<ul>\n<li>양방향 (광원, 관찰자) 간 반사 **’분포’**를 어떻게 할 것인지 계산하는 함수</li>\n</ul>\n</li>\n<li>사실 모든 라이트 모델이 양방향 반사 계산을 하는 BRDF 모델\n<ul>\n<li>Diffuse BRDF - Lambert, Oren-Nayer, Disney</li>\n<li>Reflection BRDF - Phong, Blinn-Phong, Ward, Schlicks, Cook-Torrance</li>\n</ul>\n</li>\n<li>PBR에서 Diffuse는 Lambert or Disney 사용. Reflection은 Cook-Torrance</li>\n<li>반사분포함수는 BRDF, 투과분포함수는 BTDF, 두 개를 합쳐서 BSDF</li>\n</ul>\n</li>\n<li>\n<p><strong>분포를 계산한다고요?</strong></p>\n<ul>\n<li>예를들어 Blinn-Phong이라면 Dot 계산을 한 번만 하니, Cosine 곡선의 분포대로 이미지가 결정될 것.</li>\n<li>계산에 따라 다양한 모양의 분포가 나오게 된다.</li>\n</ul>\n</li>\n<li>\n<p><strong>Diffuse Model - 램버트 Lambert</strong></p>\n<ul>\n<li>가장 기본이 되는 실시간 디퓨즈 라이팅 모델\n<ul>\n<li>모든 방향으로 동일하게 난반사를 한다는 전제하에, 빛의 입사각만 고려한 모델</li>\n<li><strong>물체 표면의 노멀</strong>과 <strong>빛의 방향</strong>과의 내적 (Dot Production)을 이용하여 난반사 (Diffuse) 계산</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token keyword\">float4</span> <span class=\"token function\">frag</span><span class=\"token punctuation\">(</span>v2f i<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> SV_Target\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float4</span> col <span class=\"token operator\">=</span> <span class=\"token function\">tex2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float3</span> worldSpaceLightDir <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>_WorldSpaceLightPos0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> ndotl <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">,</span> worldSpaceLightDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tcol<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">=</span> corl<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> ndotl<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> col<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 633px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAcklEQVQI1x2N2Q3EIBBD039bKCwJGc5wCkgpXg1/lv1sH7VWxPdF7x21NVhrUUrBnHP7nI8x4L3H+j7knEHGbIb51hrWWptjffDATyk8RCAinOcJ5xxCCFCXgrEWIUZIKZF4jAhCCGitcd33Pkopbc29PxpailjnoCuHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img05\"\n        title=\"UnitySubstance_img05\"\n        src=\"/static/e518df8d03188f444a6d15085729463a/bce72/UnitySubstance_img05.png\"\n        srcset=\"/static/e518df8d03188f444a6d15085729463a/e9ff0/UnitySubstance_img05.png 180w,\n/static/e518df8d03188f444a6d15085729463a/f21e7/UnitySubstance_img05.png 360w,\n/static/e518df8d03188f444a6d15085729463a/bce72/UnitySubstance_img05.png 633w\"\n        sizes=\"(max-width: 633px) 100vw, 633px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n</li>\n<li>\n<p><strong>Diffuse Model - 오렌 네이어 Oren - Nayer</strong></p>\n<ul>\n<li>램버트에 미세표면 (러프니스) 표현 추가\n<ul>\n<li>거친 표면의 Diffuse를 구하기 위한 모델</li>\n<li>a값 (러프니스)이 0일때는 램버트와 동일</li>\n<li>러프니스가 증가하면서 <strong>램버트의 반전값</strong>과 <strong>1-NdotV : 림라이트같은 모양</strong>를 곱해준 값으로 보간해준다.<br>\n(빛이 퍼지는 것을 표현)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token function\">Lerp</span> <span class=\"token punctuation\">(</span> Lambert<span class=\"token punctuation\">,</span> <span class=\"token function\">Pow</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">-</span>Lambert<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">-</span>NdotV<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Roughness<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>즉, 러프니스가 올라갈수록 램버트의 영향력은 줄어들고 1-NdotV의 영향을 받게 된다.</li>\n<li>정통으로 구현하면 굉장히 복잡. 근사치를 사용하여 최적화한 구현.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token keyword\">half</span> <span class=\"token function\">ComputeOrenNayerLighting</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span> normal<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> lgithDir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> viewDir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half</span> roughness<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">half</span> NdotL <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>lightDir<span class=\"token punctuation\">,</span> normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> NdotV <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>viewDir<span class=\"token punctuation\">,</span> normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> clampNdotL <span class=\"token operator\">=</span> <span class=\"token function\">saturate</span><span class=\"token punctuation\">(</span>NdotL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> rim <span class=\"token operator\">=</span> <span class=\"token function\">saturate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> NdotV <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> fakeBackLight <span class=\"token operator\">=</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> clampNdotL <span class=\"token operator\">*</span> rim<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> magicNumber <span class=\"token operator\">=</span> <span class=\"token number\">0.62</span><span class=\"token punctuation\">;</span>\n\t\tfakeBackLight <span class=\"token operator\">=</span> magicNumber <span class=\"token operator\">-</span> fakeBackLight <span class=\"token operator\">*</span> magicNumber<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span>clampNdotL<span class=\"token punctuation\">,</span> fakeBackLight<span class=\"token punctuation\">,</span> roughness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Diffuse Model - 디즈니 Disney</strong></p>\n<ul>\n<li>디즈니 BRDF\n<ul>\n<li>램버트 방식은 관찰자의 위치가 고려되지 않았는데 이것을 고려해서 계산하는 방식. 러프니스도 함께 고려한다.</li>\n<li>러프니스도 고려하여 계산 : 러프니스가 올라가면 Oren-Nayer처럼 빛이 퍼지는 효과가 나타난다.</li>\n<li>계산량이 많아지므로 아무래도 무겁다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token keyword\">half</span> <span class=\"token function\">DisneyDiffuse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half</span> NdotV<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half</span> NdotL<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half</span> LdotH<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half</span> perceptualRoughness<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">half</span> fd90 <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> LdotH <span class=\"token operator\">*</span> LdotH <span class=\"token operator\">*</span> perceptualRoughness<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> lightScatter <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>fd90 <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">Pow5</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> NdotL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> viewScatter <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>fd90 <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">Pow5</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> NdotV<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> lgithScatter <span class=\"token operator\">*</span> viewScatter<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 629px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAe0lEQVQI1z2O3QoAERCF9/1fULlwIeXCJoRYP2ebKabGzDmHLw8A7L1xiva11vWOpvq+D9baq1tr8N6zf+4+vXdorWGMwfu+PIUQSCkhhMCZUgoxRtRaIaVEzpkhzjnOCHyBdFBIYOoxBmv6Bc3Tc05+QLCzk19KuTAC/oo66O0bp2aDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img06\"\n        title=\"UnitySubstance_img06\"\n        src=\"/static/2fb9e63dbec76b72ac82d8395cc94e98/63a68/UnitySubstance_img06.png\"\n        srcset=\"/static/2fb9e63dbec76b72ac82d8395cc94e98/e9ff0/UnitySubstance_img06.png 180w,\n/static/2fb9e63dbec76b72ac82d8395cc94e98/f21e7/UnitySubstance_img06.png 360w,\n/static/2fb9e63dbec76b72ac82d8395cc94e98/63a68/UnitySubstance_img06.png 629w\"\n        sizes=\"(max-width: 629px) 100vw, 629px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n</li>\n<li>\n<p><strong>램버트, 오렌네이어, 디즈니 방식을 한 번에 비교</strong></p>\n<ul>\n<li>러프니스 값이 적으면 큰 차이가 없음</li>\n<li>러프니스 값이 늘어남에 따라 빛이 퍼지는 것이 다르다.</li>\n<li>디즈니 방식은 추가로 시점 변화에 따라서도 다르게 보임</li>\n</ul>\n</li>\n<li>\n<p><strong>Reflection Model - 퐁 Phong</strong></p>\n<ul>\n<li>퐁 반사 모델\n<ul>\n<li><green>빛의 방향</green>과 <red>시선 반사 백터</red>와의 내적 (Dot Product)을 이용하여 스펙큘러 계산</li>\n<li><red>반사 백터</red> = -V + 2 * dot(N, V) * N (벡터의 투영을 이용하여 계산)</li>\n<li>빛이 앞에 있을 때 정반사, 뒤에 있을 때 림 라이트 느낌을 낸다 (실제 빛과 비슷) - 물리적 정확성과 계산효율의 절충 모형</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">fixed4 <span class=\"token function\">frag</span><span class=\"token punctuation\">(</span>v2f i<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> SV_Target\n<span class=\"token punctuation\">{</span>\n\t\tfixed4 col <span class=\"token operator\">=</span> <span class=\"token function\">tex2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float3</span> lightDir <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>_WorldSpaceLightPos0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> ndotv <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>viewDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float3</span> reflectVector <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>i<span class=\"token punctuation\">.</span>viewDir <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> ndotv <span class=\"token operator\">*</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> phong <span class=\"token operator\">=</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>lightDir<span class=\"token punctuation\">,</span> reflectVector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> _Shinenss<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Intensity<span class=\"token punctuation\">;</span>\n\t\tcol<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">=</span> phong<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> col<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Reflection Model - 블린 퐁 Blinn-Phong</strong></p>\n<ul>\n<li>빌린 퐁 스펙큘러 모델 - 퐁에서 간략화!\n<ul>\n<li><green>물체 표면의 노멀</green>과 <red>빛의 방향 + 카메라 방향 (하프벡터)</red>과의 내적을 이용하여 스펙큘러 계산</li>\n<li>계산은 간략화 되었지만 퐁과 비교하면 광원이 휙 도는 부분 (하프벡터때문)이 거슬림</li>\n<li>퐁과 블린퐁은 모두 러프니스는 고려하지 않음</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">fixed4 <span class=\"token function\">frag</span><span class=\"token punctuation\">(</span>v2f i<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> SV_Target\n<span class=\"token punctuation\">{</span>\n\t\tfixed4 col <span class=\"token operator\">=</span> <span class=\"token function\">tex2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float3</span> lightDir <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>_WorldSpaceLightPos0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float3</span> worldPos <span class=\"token operator\">=</span> <span class=\"token function\">mul</span><span class=\"token punctuation\">(</span>unity_ObjectToWorld<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>localPos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float3</span> viewDir <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>_WorldSpaceCameraPos<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">-</span> worldPos<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> ndoth <span class=\"token operator\">=</span> <span class=\"token function\">dot</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">,</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>lightDir <span class=\"token operator\">+</span> viewDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> phong <span class=\"token operator\">=</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ndoth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> _Shineness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _Intensity<span class=\"token punctuation\">;</span>\n\t\tcol<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">=</span> phong<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> col<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Reflection Model - 쿡 토런스 Cook-Torrance</strong></p>\n<ul>\n<li>쿡 토런스 모델 - 표면의 Roughness를 고려한 리플렉션 모델\n<ul>\n<li>공식 = 미세분포함수 * 기하감쇠 * 프레넬 / NdotV</li>\n<li><strong>미세분포함수 (D)</strong> - 미세면의 분포함수. 주로 베크만 방식이나 GGX 방식을 사용한다 (스펙큘러의 <red><strong>모양</strong></red>을 계산 - Roughness를 이용하여 계산)</li>\n<li><strong>기하감쇠계수 (G)</strong> - 미세면에 입사한 빛이 다른 미세면에 그림자를 만드는 효과. (스펙큘러의 <red><strong>퍼짐</strong></red>을 계산 - 대부분 게임 엔진에선 Smith 방식을 사용)</li>\n<li><strong>프레넬 (F)</strong> - 측면에서 봤을 때 반사율이 높아지며 밝아지는 효과. 원래는 꽤 복잡한 계산이지만 근사로 구해도 별 차이 없음 (쉬릭스 방식)</li>\n</ul>\n</li>\n<li>결국 기하감쇠계수 (G)는 스미스 방식, 프레넬(F)는 쉬릭스 근사.</li>\n<li>미세면(MicroSurface)의 D (Distribution - 분포)만 어떤 방식으로 계산하느냐에 따라 결과가 달라진다.\n<ul>\n<li>Beckmann 분포 - 물리적으로 가장 정확하고 빠른 유형.</li>\n<li>GGX 분포 - 가장 큰 분산을 생성하며 금속의 정반사 표현을 사실적으로 하고 싶을 때 사용.</li>\n</ul>\n</li>\n<li>Beckmann이든 GGX든 결국 코드 보면 거칠기 (Roughness)를 이용해서 얼마나 스펙큘러를 falloff 시킬 것인지 계산하는 것.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token keyword\">inline</span> <span class=\"token keyword\">half</span> <span class=\"token function\">GGXTerm</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">half</span> NdotH<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half</span> roughness<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">half</span> a2 <span class=\"token operator\">=</span> roughness <span class=\"token operator\">*</span> roughness<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> d <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>NdotH <span class=\"token operator\">*</span> a2 <span class=\"token operator\">-</span> NdotH<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> NdotH <span class=\"token operator\">+</span> <span class=\"token number\">1.0f</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> UNITY_INV_PI <span class=\"token operator\">*</span> a2 <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>d <span class=\"token operator\">*</span> d <span class=\"token operator\">+</span> <span class=\"token number\">1e-7f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1e-7f ≈ −4.281718172</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<hr>\n<h3 id=\"커스텀-pbr-구현-준비\" style=\"position:relative;\"><a href=\"#%EC%BB%A4%EC%8A%A4%ED%85%80-pbr-%EA%B5%AC%ED%98%84-%EC%A4%80%EB%B9%84\" aria-label=\"커스텀 pbr 구현 준비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>커스텀 PBR 구현 준비</h3>\n<ul>\n<li>\n<p><strong>섭스턴스 셰이더 구현 확인</strong></p>\n<ul>\n<li>Reflection Model - <strong>Cook-Torrance</strong> 사용\n<ul>\n<li>미세분포함수 (D) : GGX</li>\n<li>기하감쇠계수 (G) : Smith</li>\n<li>프레넬 (F) : Schlick’s</li>\n</ul>\n</li>\n<li>Diffuse Model - <strong>Lambert</strong> 사용</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"glsl\"><pre class=\"language-glsl\"><code class=\"language-glsl\"><span class=\"token comment\">// C:\\Program Files\\Allegorithmic\\Substance Designer 5\\resources\\view3d\\shaders\\common\\pbr_ibl.glsl</span>\n<span class=\"token comment\">// C:\\Program Files\\Allegorithmic\\Substance Designer 5\\resources\\view3d\\shaders\\lambert\\fs.glsl</span>\n\n<span class=\"token keyword\">float</span> <span class=\"token function\">normal_distrib</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> ndh<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> roughness<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float</span> alpha <span class=\"token operator\">=</span> roughness <span class=\"token operator\">*</span> roughness<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> tmp <span class=\"token operator\">=</span> alpha <span class=\"token operator\">/</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">1e-8</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>ndh <span class=\"token operator\">*</span> ndh <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>alpha <span class=\"token operator\">*</span> alpha <span class=\"token operator\">-</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> rmp <span class=\"token operator\">*</span> tmp <span class=\"token operator\">*</span> M_INV_PI<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">float</span> <span class=\"token function\">visiblility</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> ndl<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> ndv<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> roughness<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float</span> k <span class=\"token operator\">=</span> roughness <span class=\"token operator\">*</span> roughness <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">GI</span><span class=\"token punctuation\">(</span>ndl<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">GI</span><span class=\"token punctuation\">(</span>ndv<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">vec3</span> <span class=\"token function\">fresnel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> vdh<span class=\"token punctuation\">,</span> <span class=\"token keyword\">vec3</span> F0<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float</span> sphg <span class=\"token operator\">=</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">5.55473</span> <span class=\"token operator\">*</span> vdh <span class=\"token operator\">-</span> <span class=\"token number\">6.98316</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> vdh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> F0 <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">vec3</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> F0<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> sphg<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">vec3</span> diffContrib0 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>pointToLight0DirWs<span class=\"token punctuation\">,</span> iFS_Normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Lamp0Intensity <span class=\"token operator\">*</span> <span class=\"token function\">lampAttenuation</span><span class=\"token punctuation\">(</span>pointToLight0Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Lamp0Color<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">vec3</span> diffContrib1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>pointToLight1DirWs<span class=\"token punctuation\">,</span> iFS_Normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Lamp1Intensity <span class=\"token operator\">*</span> <span class=\"token function\">lampAttenuation</span><span class=\"token punctuation\">(</span>pointToLight1Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Lamp1Color<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">vec3</span> diffContrib <span class=\"token operator\">=</span> diffContrib0 <span class=\"token operator\">+</span> diffContrib1<span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p><strong>섭스턴스 셰이더와 게임엔진에서의 라이팅 환경</strong></p>\n<ul>\n<li>섭페 쉐이더 = 섭디 쉐이더 + 그림자 처리</li>\n<li>유니티에서는 그림자를 발생시키려면 라이트가 필요</li>\n<li>그림자는 보간으로 제어가능하게 해 두는 편이 좋음 (섭페도 이렇게 구현되어 있다)</li>\n</ul>\n</li>\n<li>\n<p><strong>셰이더 작성 방식 : Custom Surface Shader</strong></p>\n<ul>\n<li>왜 스탠다드가 아니라 커스텀 서피스 셰이더인가?\n<ul>\n<li>스탠다드는 감마에서 베이스컬러 재현력 떨어지고, 전체적으로 허옇게 나옴</li>\n<li>퍼포먼스 제어 가능 - 전처리, 멀티 컴파일과 셰이더피쳐를 이용하여 퍼포먼스 제어</li>\n<li>무엇보다 <red><strong>고치기 힘듦</strong></red></li>\n</ul>\n</li>\n<li>왜 프레그먼트가 아니라 커스텀 서피스 셰이더인가?\n<ul>\n<li>다양한 환경에 대응하기 쉬움 (라이팅함수가 따로 있어서 포워드뿐 아니라 디퍼드까지 대응 가능)</li>\n<li>포스트 프로세싱과도 잘 붙음 - 프레그먼트는 분기별로 세팅을 잘 해주지 않으면 블룸 제어가 어려움</li>\n<li>무엇보다 <red><strong>만들기 쉬움!!</strong></red> - 아무리 좋아봤자 어려워서 만들지 못하면 도루묵</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>내맘대로 계산하기 편하게 커스텀</strong></p>\n<ul>\n<li>라이팅모델 공식들을 다 대입하는 것도 좋으나 섭스턴스와 다르게 보이면 말짱 꽝</li>\n<li>이론을 베이스로 작업하되, 계산하기 쉽게 나눈다.\n<ul>\n<li>Diffuse : 섭스턴스 구현을 따라서 Lambert 방식으로 구현 (모바일 친화적)</li>\n<li>Reflection : Specular / Cubemap (Metal / NonMetal) / Fresnel (Metal / NonMetal)</li>\n</ul>\n</li>\n<li>PBR에서는 큐브맵이 라이팅 그 자체가 되지만 커스텀에서는 리플렉션을 계산하기 쉽게 <red>성분을 나눠주도록 한다.</red></li>\n<li>Lerp의 직관성을 위해 Roughness보다 Smoothness로 계산하고 추후에 반전하여 사용.\n<ul>\n<li>표면의 거칠기가 높아질수록 리플렉션이 0에 가까워지니<br>\n<code class=\"language-text\">Lerp(0, 1, Roughenss);</code>보다 <code class=\"language-text\">Lerp(0, 1, Smoothness);</code>가 직관적이다.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 416px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFVUlEQVRIx6WUeUxUVxSHH6uxta1NbZo2jXZL2j/atLZ1A1mKgOIoiizDsJRFUEaGgZlhcWOZERSQzR0GqWjVNmqbxtQmSgoyMwgyIwozClFB69qYqqgoNkG+5g1iLLWWpCc5ueeec8+X33035wk8tsHBQbuL9ujRIwYGBp64uBddrI/Mj+wVGGHDhaetvaODhqMNdHZ18V/nhWcp3H9gP3naPHQ6LXnaHMo3lLKlqpKyjeXk5mbba9k5qzlSd+TJjf6hUEwMX0Gry2H6jC8JDQ9Ev1fP1n0/kFFaReHO7ympqSEsYhFTpnzKtsqt9vPi9Z8LLCxcR3D4PI60NLC3zkByfgXq9ZXEriomt+Yntv18lHnBAWzfrh+dwvz8XHQlmeh/aSZBW0PJdwcp272HAn0Va7ZWU7CvFV11JZWVm54PHBwcAlZUFFBUrkbfYKPhch8Xbt2kufM0hzus7DWa2WbsZufhH9m5o3J0wI1bilGmzCUzR86h+oPc+P0if9y8hvXaFfY3HaNi92bKy5awZ0/t6IAlpWuJi/MhJsqbuBgvMjOC0OZFosuJJEuzEN2qIAp1X1Oz45vRfcN16wqQhvsSHeNPSJg34TJvIiK+IirSh6gIH3Q5ESTEL6BKP8pHKSxci0Tiz+LFCwiVehG40J3AIA+kUm+UigDS06T4+nqzvaZ6dMCCtWuYNcuT+YEBhEkDkEpnESnzIzY6gAiZBIlkDh6eM9Dr/+VRhqdkGNjZ1YnR2EjTMRNGowmTyYjBcBSTyYSh0UhTUxONjUfp6en+G1B04Vmz+3/MrrC//yH379/nwYMH3Llzh97bt7l96yZ3796lV9z39trH69btW/ZYzIve13ePvnv36Ovrs/f39/cPAYuKi4mICCc2NpL0lemszl/DKm0eScsSiYySoVAq7H8aeXISUTGRJCbFk5i8hPjkpSSrUlgqT0AmC0WrzR0CLl+eid9sb0q3lbC+dhdLc0pRFGwgs2wrIVEyQsIW0mGzERIajCTQl2meU3jtzQm4jBvLhElv4xM4D3+JHylK+RAwK0uDckUaG/fXkVpUwxp9LerCElZu+hZVWS1xS+PoaO8gKjqMT6Z8yJgXXHBwEHByEhAEAdfx43GTBJCxXD0EzMlWs6pIS2VjN41dv1HfZuaAwUj1IQPrDzaTmZuFxWwhONSfF18dg5OzgKurA84uQ6vg5MC7kz9mRbYGYWBgkOzsdOIT5lBRXU7n2XauX79Ax6Uedv1aR/7mPNRpUZgtbfjOccN5rICLiwMuLgLOzkPu6OzA62+NRa1OQHj48E8yl6uZHzgVmdSNxARf1OoFaFRBpCXPQZPiT1JiOC0trcyd74PrCKAYOzoKTJw4FpU6CUF88owMDbMD3AkK9iRwoQdBi2YSHOJhn9/o6NnIZGGYmpqQhi/ivQ/ewNFJwOUxzMFJYNzLDkyf8REpqQqE3t47KBTLcHefhp+/O17ek/H0+gxfv8+RSNzw9nJDMn8u9Q0NzJUE4Ok1jUnvTMB1zJDCl15xZPIX7zPTYypx8TEIN27coLi4CLl8CRqNGpVKgVqjQKVaRmpqCikpyWRlZdBqNpOekY5SqSA9XYVSKUe+LJ7UNDkqVSqJSxaTn69DuHjxIleuXOHs2bOYLWY6rFYsJ05gtdpob2/n1KlT9rjt5Elsp09js9loa2vDbLZgs53m5Kl2zpzp5OrVq1y6dBnh/Pnz9PT0YLVaMTWZ7FCDwWBXdPz4cVpaWuzNra2tWCwnsFgs9lx9fb29fqy52Z4XGSJL6OrqQnRRoZg4d+7ck/XpeGSuu7v7SSz2DnP+AqUJULWkC+ruAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img07\"\n        title=\"UnitySubstance_img07\"\n        src=\"/static/8ace04dd318f0609606120e5eb447027/b0122/UnitySubstance_img07.png\"\n        srcset=\"/static/8ace04dd318f0609606120e5eb447027/e9ff0/UnitySubstance_img07.png 180w,\n/static/8ace04dd318f0609606120e5eb447027/f21e7/UnitySubstance_img07.png 360w,\n/static/8ace04dd318f0609606120e5eb447027/b0122/UnitySubstance_img07.png 416w\"\n        sizes=\"(max-width: 416px) 100vw, 416px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><strong>Specular</strong></p>\n<ul>\n<li>큐브맵이 광원정보를 포함하고 있을 수도 있고 아닐 수도 있으므로, 큐브맵은 제외한 채로 스펙큘러 계산을 해 준다.</li>\n<li>어차피 스펙큘러는 프로퍼티에서 제어 가능</li>\n<li>유니티 스탠다드 셰이더의 GGX 구현이 섭스턴스에 비해 좀 과한 구석이 있으므로 적당히 감쇠하여 계산</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 559px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADIElEQVQoz02S/0/UdRzHPz/wJyD81g/SLEstDHGZm+hhBkLSKdFCs/VLuO5uded98b5xIGXJ11vJtyKLEkWg8DMNEE/YjXU6XIWrBXmSDELNo90Z9/Xz+dyj3TUYz+2593PP9+v13Gt7vQRRFNFoNBj0erQaDUajEYPBgE77v9ZqtUxPT7OQgJ8exZmJwlQgzs0/HzE5H2TqH5lfg0l+WZJYjCgINpsNQRB4csNTvPPuMZx1p9AZbezZV0JmZmb6z+O5xlQMxEWFJnGCKusnmE820tnzHaJvisuzQcS/JH4PyQg1NS6eeXYT3/QOcHvGz2JgiZu3f6N7cASNyUF2djbjY2PcA+r7RilRv4nmAwuff9XD7Nw8iViEuft/c3VhmTvLCkJ1dTXHdO8z5rvF/IMHpHB/KcDAiIcz3w6S/1IBnmujTMdBfbSKisoj2Go/ZNgzgcIKFCYXAsz8KyE0NjbiqK3j0vAoM7N3CEdD3J27y0XxMp+e7aH0UCVer5cb9x5SWLQftbqU93Qaevu/R5Lk1Uj/wwD+UAyhoaEB/XE9HV90cv7iOa4MDXLuQjdN7iY+bqinuPRAOvDHP+bYoypg765tVKiLOWHRc8PnRZKiQAxxeITRiUkEl8vFofLXOF1fh8tlo+6kA6fTkm6odlrIzX2e657r9A6KFBUV8uLWDRTs2MzBA3uxGrX0X+ji6g/9OFw2+gb6UkupJSdnPScsBmpcVhx2I3arAbtVz+HK11m3Lis94Zdn2zn6dgW7d24lb/MT7Nz2NGXFu9BWvYXhuI5XK8r4uqcbweFwpE8jFbq/ZB+Hj7xBeXkZ27fnkZWVRUZGBuPj4zQ3f0TBy7vZoVKxJXcLGzfm8ELec6iKVbxysIj8wnzautoQhoaGMJlM2O12zGZz+rVYLJhMZpxOZ9rz+/38fMtLR2cbLa3ttLR1cNp9hlPNbtztn9Ha1Yq7vQXfpA9hZUvh5TDhSJhkUkGWFSLRKAlZYi0iyxHi0RhSPMbjxyEikShSIkEwGEJKxNM1gqIoSJK0SlmWSXkppnSKyWRy1VuhtKZurf4PEZC4oAfdj6MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img08\"\n        title=\"UnitySubstance_img08\"\n        src=\"/static/13dc51514d4a7b312ef41f5b65632d28/a65ce/UnitySubstance_img08.png\"\n        srcset=\"/static/13dc51514d4a7b312ef41f5b65632d28/e9ff0/UnitySubstance_img08.png 180w,\n/static/13dc51514d4a7b312ef41f5b65632d28/f21e7/UnitySubstance_img08.png 360w,\n/static/13dc51514d4a7b312ef41f5b65632d28/a65ce/UnitySubstance_img08.png 559w\"\n        sizes=\"(max-width: 559px) 100vw, 559px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><strong>선형보간, 비 선형 보간</strong></p>\n<ul>\n<li>보간의 3항은 아래 4가지 중 하나를 선택\n<ul>\n<li><strong>선형 (Linear)</strong> : 제일 많이 씀.</li>\n<li><strong>제곱 (Pow)</strong> : Pow를 그대로 쓰면 무거우므로 직접 횟수만큼 곱해준다. 앞쪽에 가중치</li>\n<li><strong>제곱근 (Sqrt)</strong> : 뒤쪽 값에 가중치를 두고 싶을 때</li>\n<li><strong>스무스스텝 (SmoothStep)</strong> : 중간값보다 양쪽 끝에 가중치를 두고 싶을 때</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>유니티 씬 세팅</strong></p>\n<ul>\n<li>컬러스페이스 감마 (추후에 리니어로도 전환)</li>\n<li>HDR 세팅 - 그래픽스 세팅, 퀄리티 세팅, 카메라, 포스트 프로세싱</li>\n<li>라이트는 한개만</li>\n<li>Environment Lighting (ambient) 값은 0.5 이하로 적당히</li>\n<li>Environment Reflections 값은 0.5가 적절. 1로하면 너무 밝아진다.</li>\n<li>씬 세팅을 이상하게 하면 스탠다드 셰이더는 특히 굉장히 보기 흉해지니 주의</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 595px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.1111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADbUlEQVQ4y41Ua1PaUBTM//9aP9qxLVgB5aGBII8g8goEwlteGkBAEEZnHP3udvbExI6d1jKzc8lN7mbPnj1RhsMharUaTNNEo9HAZDLBzc2Nh+vra9i2LSvvuevv4N5oNMJ2u4WSz+dxcHAAn88Hv9+PVCqFXC4nCMdU/AwEcXh4KPuFQgF8/iO4n0wm0Wq1oFBZLBaDqqqy6RKWSiXoukPM/WKxKJUYhoFqterBqBqyf3l5icFgAKVerwvh6empHCRxOp0WAr6dhDwghysVGBXjHcY7qJLlK5RJsmAwKGTRaBTZbFYIM5kMzs7OZHVt+IgLrrou/8fjsaOQinjILfni4kJKcBW6PhF80UfQHp4RQnp4fHyMk5MTJBIJUUS4pFTLkuqm6ZRtGH+A+8VCwSFsNptSaigUgqZpKJfL8ka+OZk+RzgSQTwex/n5uShlRWbNlJgJak7cqL7f7zuEVBQIBISU/1kmCfWcjqSmifJ0Ki0v+9iMqlGVfVbETCuWZUkjjo6ORAnV0keWSxJeE7zn2sFU8IwL3tf1rARcmc/nknJOw93dHTabDdbrNRaLhTcty+USo/FEwGjwHp9drVYCPj+bL3C33kChTNZPb3q9nmA6nQoR8+dc2whHYwgEQ9IkqmfUdF2HntUlOvG4hnrDgsKDNJt+uBGwGg10e30YpoX5bArbniKuqgiHw+IVy9/7soev+/vw+3zw/fDh+7dvaFoWFJbLDvJBNoMR6LTbaLW7KNcsLJcL0JZINIpg6E1hPu+dYVMICpHRo3cVjtRbnprNlgx5q91Bo9nB7e0cs9nMmyIScQgikYj3wSBI7hHSE/rF9jNGk/EYV8Mxao02VqslZrO5kLgfDv4X/3RdzlIQ9yWHLJkjR0Imnddsf/9qgFy+gNFwKNf0jSNKv6nGHUOuMinFoqNwt9tJZNhZRuDx8REPDw/Y7bYYj0aY2rbEhqPJ8LPsTDYLVY0jEScSXlO73S4U/Mfv+flZ5p1fJE1LIKZq0JIp5N8aSVB9p9OB8vr6in+Bv5eXF5lblja4ukKr00On25NRY5lc6R8rUT4jowVsVrvdFlLas9msZaLu7+9lSgja9fT09PeSXUJ6zOyxw5wmek3Sfr/3lghnHKmS4/gpIRXyA8IU8DNF41leqcKx7HvzzoRQ8S83uxbmUUwQKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img09\"\n        title=\"UnitySubstance_img09\"\n        src=\"/static/fe47742e9d72518351ac1b9977c9ecec/3dd3e/UnitySubstance_img09.png\"\n        srcset=\"/static/fe47742e9d72518351ac1b9977c9ecec/e9ff0/UnitySubstance_img09.png 180w,\n/static/fe47742e9d72518351ac1b9977c9ecec/f21e7/UnitySubstance_img09.png 360w,\n/static/fe47742e9d72518351ac1b9977c9ecec/3dd3e/UnitySubstance_img09.png 595w\"\n        sizes=\"(max-width: 595px) 100vw, 595px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><strong>텍스쳐 병합</strong></p>\n<ul>\n<li>Albedo의 알파채널에 Roughness를 넣는다.</li>\n<li>PBR Texture 안에 AO, Metallic, Normal.xy를 넣는다. Normal.z는 셰이더 안에서 계산.</li>\n<li>이렇게 하면 총 5장의 텍스쳐를 2장으로 줄일 수 있다.\n<ul>\n<li>텍스쳐 샘플링 수가 줄어들어 퍼포먼스 이득. 또한 메모리 사용량을 확 줄일 수 있다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3 id=\"구현-결과\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84-%EA%B2%B0%EA%B3%BC\" aria-label=\"구현 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현 결과</h3>\n<ul>\n<li>\n<p><strong>섭스턴스와 아웃풋 비교 01</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACXElEQVQoz22Q20vTARTH9w/1Ui9BCqkk2boQZRlBIWg9qKl4mc7p0sS8RaLipRRDU0cYKmWKgVPnpSRsmdaYefnN7Te3ue23TZmb2z6xXz52Hs7DgfM95/NRfPxzzMCCidaRabpmBWbcxxiELaaMRhalAOvA8JdltB3tTGxv4wOIRuOdk5MTvJLE0dERkUhEnikWHBKLpk0ah/UMrW7zed/L/E8j09/WmN+zMm2zcedxFpm52RS3NGMPh+XF2Gmgy+XCHwgQPT2i0H+dYmhynPLGWp63VdMz2kdVUxHPGgrQjXfRMzHGjYw0lLcvcTU9hdV1I/+ejBIMBnEduPD7/YTDYWKxGAr9pxe8bMhCXfGAxrr7lFRlotI8RFWaQV19PpqafK6lp3I+8QypNxMxrBhOAyP4/H7cbjc+n0/Gjh9RHBzsY7EKCFYBqyjgdO9jdzvYc4g4PU4cLpEtqxWzxcLvrU3EhWWCOxYZ+X+lmNyJ0jE2R3u/jm79DktHMLVmZHDiA0suF2bg/fdVWvrfMCfacERjxEIhGS+OKUkSh4eHsk8ZeWB2kdyiXApLcqjpfs27H79Qa1Wo1EW09r9ixi6SdF3JRWUKnbo+tg8DhEMhgsdB2d2usIvD6ZSR404VvW87ySl+QkF5CarqUuo7mlBr1VQ+VdPc1kz36AgJyQkkpSVS31KLYWWJQCCAx+PB6XQiCAKiKMouvV4vCl2fmsrKR5Rp8tBq7pGdd4vCshzUmgLKK3LIL84kSZnMuQtnuXL3Mr2DPUheCZtow2w2s7GxgclkYlcQsNvt/AU7r0YvVehsIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img10\"\n        title=\"UnitySubstance_img10\"\n        src=\"/static/7b11edbf1fd726ae51044e42e0da1d17/37523/UnitySubstance_img10.png\"\n        srcset=\"/static/7b11edbf1fd726ae51044e42e0da1d17/e9ff0/UnitySubstance_img10.png 180w,\n/static/7b11edbf1fd726ae51044e42e0da1d17/f21e7/UnitySubstance_img10.png 360w,\n/static/7b11edbf1fd726ae51044e42e0da1d17/37523/UnitySubstance_img10.png 720w,\n/static/7b11edbf1fd726ae51044e42e0da1d17/302a4/UnitySubstance_img10.png 1080w,\n/static/7b11edbf1fd726ae51044e42e0da1d17/73caa/UnitySubstance_img10.png 1110w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><strong>섭스턴스와 아웃풋 비교 02</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACHklEQVQozx3HW09SAQDAcb5NW0891tp6UWdbYjG13Ax1aquZTfOGzul6SbeWYQ4SUvESxOXcuN8P54CACh4Ewta3+Td9+u1n0jSRRNJNOLxHLLKLKO0Rk+1Ikpu4/B357g4U4TsR2UlU3CEsu4kJ3xADDmKCHTGwi/R7GyXkwKRlj0iIWyQVO3rKQUy0o6ddxBUneuaATOInhbQHNXVILn3MWeEXas5HRfehZr1UiwGKeT+lgp+yLmBqtG4oVWvcWjOatG/+Ubtq0O78pW40aDRbNNttrgyDdqfDZe2SZqvJ5eWt13c3jCvq9RqNawPTzNJbBqwWJmfGsIy8YGF9nkHrEMsby0xMTzK7MsfC2gKjb8ZY39ygb6CPpU82evt7eTc/TXdfN6/Gh+l9/hTzoBmTIns5OXIiBD3IkhdZPEUSfSiyj7ASRFECRCIiougnGlcICX5iiTAhIYgckRDEEHJYvFNSJExiPMBBwMWJcIhP8SAkAoRix8TVMOG0l3w5RUqTUCsJihcp1EqUequMWlZodKpo51GMP2foF3Hq7SKmoZEuHnfd40nPfXrMD3hmeUT/y4dYp8wMj3fxYXGUqfcWZpdHWVybYM5mZfOrjVnba77srDO/amVre4WPq2N83rZhqlR18vkkaiFNtayRO3BRjIiUKwXOL0qUtAxZl5O0+wf5oJfM0T7FQprKeREtnyTn2SfpdpI/9aBnk/wHw9DLy5VU014AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img11\"\n        title=\"UnitySubstance_img11\"\n        src=\"/static/0443a1b3e807ed35547ca929d3a26830/37523/UnitySubstance_img11.png\"\n        srcset=\"/static/0443a1b3e807ed35547ca929d3a26830/e9ff0/UnitySubstance_img11.png 180w,\n/static/0443a1b3e807ed35547ca929d3a26830/f21e7/UnitySubstance_img11.png 360w,\n/static/0443a1b3e807ed35547ca929d3a26830/37523/UnitySubstance_img11.png 720w,\n/static/0443a1b3e807ed35547ca929d3a26830/302a4/UnitySubstance_img11.png 1080w,\n/static/0443a1b3e807ed35547ca929d3a26830/4ad3a/UnitySubstance_img11.png 1152w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>▲ BaseColor = 1, Metallic = 1</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB/klEQVQozz2QW28SUQCE95eZmGjEGMRqm1oBG6EtIrVpNdb0xdtPMKmJD0YjXdhdEEphuSzs2bNnL2yhEm38P58pJj5MvmRmMg+jOfKMlq3THZjYjslQnDIcW4hwiCOaBOcuwu+gpiOCxEGGPaZziZBt4plkLFr40QjHbSGUjTbxmvT6XxmOdaTfYOI1CIImUrUJoxbR1CaM28RJlzjpEScdprMh06RDnAwI4xbTpI+v2ktqQaiw+zZSSTxfogKF8FxUqHCFi/Q9PCkQUiy9iTtGKm9JFfi4YrLM/cAnikO03Zdl8jtZsoWHPMiuUNrfJrOeXjK9docn5ces5u6TLW6wtVvgVvoGpYNtrqeusfW8QCpzk1xxg9XsCpulPFq316F68o1avYpl1Wk0DQyzTuOHQd2sYTXqmGYNw9SxGga6XqXZsjjRq9QNnZqhY1p19FoVq2GiXZ3t+Ke4wRny6q/5BBGdkSw8ZNxl/lsRzAacLwTJwiW6GPHzMiCc9Vn8iQjObS4uFfF8xOyXh1Y5eETxWYbc1m0KlTSlvXXyOyn2X2+SL6U4fFOiWMlwcLTJ3mGO8os1jt6X2d67x9GHCsXduxy+e0ppf5VXb3fQhDfC7rexB6d4crSU9McIb4hUY9xJH/vTR3qfj+l//0L38zETp/cvE0Ok7/zvXm39Bb/G0dSZqH1CAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img12\"\n        title=\"UnitySubstance_img12\"\n        src=\"/static/bdb9f21e307e8f7a5a9c9d468ff0006e/37523/UnitySubstance_img12.png\"\n        srcset=\"/static/bdb9f21e307e8f7a5a9c9d468ff0006e/e9ff0/UnitySubstance_img12.png 180w,\n/static/bdb9f21e307e8f7a5a9c9d468ff0006e/f21e7/UnitySubstance_img12.png 360w,\n/static/bdb9f21e307e8f7a5a9c9d468ff0006e/37523/UnitySubstance_img12.png 720w,\n/static/bdb9f21e307e8f7a5a9c9d468ff0006e/302a4/UnitySubstance_img12.png 1080w,\n/static/bdb9f21e307e8f7a5a9c9d468ff0006e/1132d/UnitySubstance_img12.png 1158w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>▲ BaseColor = 0.5, Metallic = 0</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACNUlEQVQozx2Ha09SAQBA+Q31odlqc0YPwydm02YPbctw07Yyc+IszQ/WqLVeJm3OVIxUBEVREIPBvRdBFDNzqV9aknDhXh5urfVrTosPZ+cczf5eGI93FK9nBI97mBnbIN4lM58mB3E5XmGxvMBpe4llzITV8pzJ8QHeD/Zht5oYetOPzfKUodePGHn3kIkPJjRyPEY0OMq3dTt7X2ZZD02xv+1iTZpmd2uBiDjNzqaLWGSW2No82+tOwqKd3S03EcnJ9y030dAcmxEn25vLaH7/+cuPeIKUmiugZPPIaQU1d0RKUVGzucKnFAUlk0FOpVAzGZKyTFpJk5STpNIpkskk2WwWTc/jLrQVZ9DVXOBshRZ9g57zleeoa6zjor6Uy9dqKa8tQ1ejo6q+kpLSYnSXdJwqOYm2TEtR8QlOa09xvOgY5foyNHu7OywtOvD7PUiiH0n0IUkBRMGHKAYQBD+hkFBoSQoiCAHEkIgoCUirIlJILFiQRDZiG2hWhHnejjzDYjNjsZuxOob56DBjX5xg1j2Kc3kS12crnsAMnoANr/AfB8vBKVaEORZWxlnyTTHnHsMvzaMZMHWhry+h6XY1TYYqGpurudlSheFOA63tV2i9d4N2YxMd3c10dN/C2Gegs6eFrl4Dxt427nZe576xmbb2q/Q/eYAmf5ThMPGTpBwnl1NIhCXkna/k8gr5vIqqJDhclTjw+/gVixJflVASB+SOMqjJOHEhwIEY5DAaJpNK8A96oac3h47oTgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img13\"\n        title=\"UnitySubstance_img13\"\n        src=\"/static/9d65d371862ff70fc28472c236d81d6e/37523/UnitySubstance_img13.png\"\n        srcset=\"/static/9d65d371862ff70fc28472c236d81d6e/e9ff0/UnitySubstance_img13.png 180w,\n/static/9d65d371862ff70fc28472c236d81d6e/f21e7/UnitySubstance_img13.png 360w,\n/static/9d65d371862ff70fc28472c236d81d6e/37523/UnitySubstance_img13.png 720w,\n/static/9d65d371862ff70fc28472c236d81d6e/302a4/UnitySubstance_img13.png 1080w,\n/static/9d65d371862ff70fc28472c236d81d6e/5a3c9/UnitySubstance_img13.png 1169w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>▲ BaseColor = 0.5, Metallic = 1</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACLklEQVQoz03J3UtTARjH8WOGzs2XEu2yO2+kSCeGEJYvc05J0nJp2lLLOV9q5dLNliRpSZRKKDhRCbUpVuqFrTyeaYKC6c5xynzZpD/mGy6iLr58eH6PMDXtosJUQmt7Pc2PTdRZbmO11VBde5M2Rz23KotoeVRF1b0SauvLqW80UmYs5KG1mjKjHktTBcYKAzU1pViaTAhrawsMDNj56O5javIto2M9TM/0M+zq5vOXIQaHXuB29zM69poPE++YnOpjeOQVs58GcY30MjPzntHxN0xM9DM760JQ/H4WFhcRJYllrxdpdRVR+quEd3WVZa+EtOINKy6LSF6JJXEJURL/uCzi+e5hfWMd4c5dI6fUAvFJajSJKuKTNcQlqUk4F0tcopqE5Fg0Z1RozsagTlChiosiOvY0UZpIImMiiIwWiIgWEASBlNQUhFAoyI81L5ubGyjKNrK8haL48Pl+Isu+8C3L2//lC6co8j8VGZ/s4+BgH8E13ofJXIbVXsuTjvtY7XXYnj+gtaOBzp5mWh1mnN0ttHc24uhqxtFlwfasAWd3I23Ok62BNudJZl72PkWw2c1c0J4nO/8iOfo0rlxNJbfwEtd0GRSXZpGdl0bR9UzyCtLRGTLRF2eQo9NSdCOLfP1lCgxacvK15OrSKa80IASDh/j9Mrt7OxwGdtmZnyewsc7xryCh4yP2tzaR3dP4PV/D7a6sEAwdhH9HgV2UuTmUhXn83zwcBfb4DZ2RkiA961R9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img14\"\n        title=\"UnitySubstance_img14\"\n        src=\"/static/53f851a57287c7861ff2e896cd717f7a/37523/UnitySubstance_img14.png\"\n        srcset=\"/static/53f851a57287c7861ff2e896cd717f7a/e9ff0/UnitySubstance_img14.png 180w,\n/static/53f851a57287c7861ff2e896cd717f7a/f21e7/UnitySubstance_img14.png 360w,\n/static/53f851a57287c7861ff2e896cd717f7a/37523/UnitySubstance_img14.png 720w,\n/static/53f851a57287c7861ff2e896cd717f7a/302a4/UnitySubstance_img14.png 1080w,\n/static/53f851a57287c7861ff2e896cd717f7a/04784/UnitySubstance_img14.png 1174w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>▲ BaseColor = 0, Metallic = 0</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB90lEQVQozy2Pa2/SABSG+ckmGo3R6AcXY7bpnAq7MTfYhLgL64oD2tIrtxZIgLFLhhswWxhQ5C88hs4Pb845z/t8OSF/cs943GU46HDfbzOduvS6DWazIb1uk+nUC/hodBek3zvn79QLHN//w32vxXjcZ+Dd4PsuIde9pNut47otBoNzRqNrXHcu3+G5TXz/Fs87x5/cMBxe8fBwwWTym8GgxWRyizt3Jh08r81s1idkOzaCICDJEqJ4iq7rpNNpDMNATIvkctmAZbMZLMviOHVMoVAgdZLCNE1yUg5JyqEoCqZpEMprMrF4lIOjBIvL7xHTxyyvfCB9JrCyukTy5x6xve1gz+REnj1/giSf8eLlU35lBCLrX9jYChPf/85ufJtQteYgnKbIqzK6oWIVdFQtj2lpGKaGaeloeh4lLwWdLP+fioRhqui6iqYpaLpCpVIi1GgXqbd0nEaeSj1H87KEURa4uW1glE+4uHYo1bI0LqzAK9cytK9tLFvkqlOnWD2jeVmk1tS46tQI7SXDRGNLRLYWiEQX2N3/zEr4NQepbT59e0XycIOvkTfsxD+ytbMYeInDdVbX3nJ0skN48x2JgzWisWXEzI/5yxVUTca0VGy7iOOUmDPbKVKr21TKJlYygR6PUThNBf28q1bLj87ctR/vef4BX48HUy0aNcYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img15\"\n        title=\"UnitySubstance_img15\"\n        src=\"/static/386c8ca06bbf6de2b33bfb195e68b2cc/37523/UnitySubstance_img15.png\"\n        srcset=\"/static/386c8ca06bbf6de2b33bfb195e68b2cc/e9ff0/UnitySubstance_img15.png 180w,\n/static/386c8ca06bbf6de2b33bfb195e68b2cc/f21e7/UnitySubstance_img15.png 360w,\n/static/386c8ca06bbf6de2b33bfb195e68b2cc/37523/UnitySubstance_img15.png 720w,\n/static/386c8ca06bbf6de2b33bfb195e68b2cc/302a4/UnitySubstance_img15.png 1080w,\n/static/386c8ca06bbf6de2b33bfb195e68b2cc/96220/UnitySubstance_img15.png 1165w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>▲ BaseColor = 1, Metallic = 0</em></p>\n</li>\n<li>\n<p><strong>섭스턴스와 아웃풋 비교 03</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACcUlEQVQoz1WJa09SAQBA7/9oay17Y0oyRSFBUVGBMIqHpJZPwBWTwBKNSHLT7GVqRlppWqm50jJbH2quxxotDdd6CPdC9U9Om1tufTg7ZzvC5OIr+u9NEBkaxOP30T86yvDjZ8wsLREMVdMVqaDJU4SjVkO4r4rzl21MTPfgaMjl1JlS7LUabE4V7WE9Yw/OIURnn9AY8JKTvwdVnoyjdiPd0XGm5p8yPuIiEjZjMis4alHT2V7KwqMWFuf7CLWX0dKip8pWxBGrhpGrVhbmOhFuPZzCUmsjU76Hw3YTKq0Cs9POzPM5ooMu9OVyyoxaTrgclFfkMjns5uObMQI+M+VGNa2+ZtzeRmqdGt4uDSBErvSgUGayY9828tQH0JQoMR7Wc3dqhNM+G3n5O1GqZVSYDmIwKPCfrODp7ADOY2Voi7Mp1udjdRqwW/OZvHMe4ergRZo9DmTy3WTs3oJKk02w28/96VEuRWo4ZJIjk29n7/6t1NdpGR+u5+FEH22eYgwmJTJ5BgWFWQT9lTx5FEa4cbuHUK8XtU5JgTYHnUFDV6+P2+PX6L1godqahepgJrnKXTTUFXIlYmEsGqLxeBYWiwJdaQ7FJTmcbtVybySAMBTt4WJ/G27vCXxnWwgEPXT3tnFn4jrnOmpoPK6j2lGOx1XJSXclkQ4H0ZsRahwqmpuMuNxHONVahdelJzpwFkFKJUmK66ytrbKy8okv8c+I4jqplIQoJojHV4jFPrC6GttAEn+STokkEj/4urbC+5cviL1bZj3xjZSUREgmRSQp9R+pVHrT6fQv0un0Zv97Gy1KfH+9TOJLnPTvP0iSxF/O/7246mMwiwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img16\"\n        title=\"UnitySubstance_img16\"\n        src=\"/static/ba200d919a5a971219b8a0a6097bd255/37523/UnitySubstance_img16.png\"\n        srcset=\"/static/ba200d919a5a971219b8a0a6097bd255/e9ff0/UnitySubstance_img16.png 180w,\n/static/ba200d919a5a971219b8a0a6097bd255/f21e7/UnitySubstance_img16.png 360w,\n/static/ba200d919a5a971219b8a0a6097bd255/37523/UnitySubstance_img16.png 720w,\n/static/ba200d919a5a971219b8a0a6097bd255/302a4/UnitySubstance_img16.png 1080w,\n/static/ba200d919a5a971219b8a0a6097bd255/22c86/UnitySubstance_img16.png 1143w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACt0lEQVQoz5WS3U+SARTG33+iy/6AtrauWuuui1Zb3WS12czWbMuVq9AyZWWSofFl8aGAChVODA0JkpZpS8pCBGbAK+8LURiC13rlV1z8mm/roosuerZnv7Od55xzc4RqtcrW1hYbGxsKd3Z22NzcZHt7W+Guq9Wf7CrzZRbfsJbJgA3fSC+jHh2hgBmPV4PT3YKY/Yywtr5GKpUikUiQyWQoFAqIokgqnSaZTBJbiLG+vqYs9I/quXhmLzevHKKh/iC1p/fTcGEfp2r3cPiIwESoD4H/0Oy0F83tk5h1DTzoqEPdUoO2sxZ1x3EuXTnAx08vEaLxD0jfFvlaFJEKaZbyaZZyIouZFIlUkvlkjLlYjO/lNN/LMQqlKMVynEJpnnwxSqEUQy7OsfT1PdK3KILL8xDv+GM+zPtYSAV5PfOU8IwHf8jFiM+O84kJ+2Avkfgg8awL6YcfsehFLD4nvvSMhDRMIjvMguhhNuFA0Bub8I0/ZHLKRHRxgDfvewlM6ghPPyI8ZeWZ9y6PLLcIhDXMRDuIxLuZSxp4F71H4K2KqUgH0586GQ+rCL5tQzAYrzLkbmc6YmMqYsThvoHNfp1Q2MiLV51Y7Nfo6r7KWLAd/2QzY6HrzMb0jAdVOFznmXjdTCSuZXSiCYv9PIJafQ69oZFAUEfgVQ/annqcQ62M+u/R1X2O9junaWmtx2itw2A9hVZXg8V+FrPzDHe7jtGlP0H/YB1Gaw1qzVGEIXcPz30mgiErLvd9LLY2xvxGXE8eYO1rR29SYXNo6BtoxWRupN+hwjnUjHWgCZP5Mk9H2ui3t6AzNWIwNyJUVitUKhXknKz8nyRLSi3LssJSqcTKSlnx6mqF5eVl0ukMmczvrCRJZLOS0i+vlBEkWSabzZLL5cjn8wr/5d0jf3K/s3nyufxfc78Apcun5b9RR8wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img17\"\n        title=\"UnitySubstance_img17\"\n        src=\"/static/b528def12e3669aeb85c9b68bc259bf9/37523/UnitySubstance_img17.png\"\n        srcset=\"/static/b528def12e3669aeb85c9b68bc259bf9/e9ff0/UnitySubstance_img17.png 180w,\n/static/b528def12e3669aeb85c9b68bc259bf9/f21e7/UnitySubstance_img17.png 360w,\n/static/b528def12e3669aeb85c9b68bc259bf9/37523/UnitySubstance_img17.png 720w,\n/static/b528def12e3669aeb85c9b68bc259bf9/302a4/UnitySubstance_img17.png 1080w,\n/static/b528def12e3669aeb85c9b68bc259bf9/51800/UnitySubstance_img17.png 1196w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><strong>메테리얼 미리보기</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFElEQVQ4y4WTb2/aQAzG8/n3AfYZeDESwlJKyF3uklDQIAvVKJ0YFCS28udNw9pOGqHwTDY9CpqmRbJ80jk/P7bPFgDs9/u/zHzmvFwuUS6XkWUZ0jRFr9dDv9/HYDDA19tbdDqfsc7XsHa7Hf71EcsA8zxHrVaD7/sIggBaa0RRhGaziW7axd38Do+/HmHRJWWhbGTD4RCj0QjD4TdcX39BURRHYL1eZxiBlFJ8VlqhFbcwcSZ4Xj3D8jyPLygzBVEwZc96GSbTCTabzREopWQLw/DNVIg4iHHz/gZP8ydYlUoFQgiWHscxQ5tXTXQ+dTAdTc8UUnLXdTmeYOQpgZAC4koi/5nDojLMJSkNGgFkIpF+SHH/7h7F71fgQ86warXKEKqEBOgoQhgqRDriGIsazb1Q6lCCDCGVhPIUMj9DsX1T6LoVOI7NUIo/VKTRCCQirTnGsm2bp2dUsgUCIhRod9vYFtsj0HFr+HjROCjTmo2AUipopfBACh3HQaNxCEqSBMmrj+IY7VbrrIe2XUG57LA67p0IuDohJM9gvV7DKpVKPOFDgICgSfo+RO0ScZKcAS88j2Mpuem58aSWgePxGLPZDIvFAov5nP3y+w8sZjOsVivsXl6OQHoRZPQzQagyYzQkBuI/3+mmUHto0gQkSP2yzorppVAbeCi0emS8w6fenE+ABKO3aNaOPA3TbA4p/AP8r4WRlW9ghgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img18\"\n        title=\"UnitySubstance_img18\"\n        src=\"/static/43ba5d644e5b74834e1af3e86ca338ad/37523/UnitySubstance_img18.png\"\n        srcset=\"/static/43ba5d644e5b74834e1af3e86ca338ad/e9ff0/UnitySubstance_img18.png 180w,\n/static/43ba5d644e5b74834e1af3e86ca338ad/f21e7/UnitySubstance_img18.png 360w,\n/static/43ba5d644e5b74834e1af3e86ca338ad/37523/UnitySubstance_img18.png 720w,\n/static/43ba5d644e5b74834e1af3e86ca338ad/7ae9c/UnitySubstance_img18.png 972w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>최종 구현 된 모습\n<ul>\n<li>텍스쳐만 넣으면 옵션 건드릴 필요없이 <red>알아서 모두 계산</red>된다.</li>\n<li>옵션을 조절하고 싶다면 PBR Setting을 체크하면 상세 옵션이 나타나게 구현\n<ul>\n<li>(<red>C#으로 ShaderGUI Editor 스크립트 구현</red>) : 이렇게 하면 GPU Instancing 항목이 나오지 않으므로 추가 처리가 필요함</li>\n</ul>\n</li>\n<li>체크해제하면 다시 좌측처럼 되고 변경한 값들은 다시 1로 고정됨</li>\n<li>Using … Reflection 처리들은 최적화를 위한 처리들. 별 차이 없는 경우 계산하지 않게</li>\n<li>기본값은 모두 1로 맞춰놓음. 초기값이 헷갈리는 경우를 대비</li>\n<li>섀도우와 하프램버트, IBL Blur를 제외하고는 모든 값을 0~2 사이에서 제어하게 맞춰둠</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>프로퍼티 설명</strong></p>\n<ul>\n<li><strong>Roughness Amount :</strong> 러프니스 값 조절 ( 디버그용. 기본값 0 )</li>\n<li><strong>Metallic Amount :</strong> 메탈릭 값 조절 ( 디버그용. 기본값 1 )</li>\n<li><strong>Use Optimize :</strong> 각 리플렉션을 계산할 것인가 ( 최적화 )</li>\n<li><strong>Use PBR Setting :</strong> PBR 커스텀 세팅을 사용 할 것인가\n<ul>\n<li><strong>Normal Strength :</strong> Normal의 강도 제어</li>\n<li><strong>Shadow Amount :</strong> Cast Shadow &#x26; Receive Shadow의 강도</li>\n<li><strong>Half Lambert Amount :</strong> 하프램버트 정도. 0일때는 램버트, 1일때는 하프램버트</li>\n<li><strong>Diffuse Boost :</strong> Diffuse Reflection을 보정할 수 있는 전체 보정값</li>\n<li><strong>Fresnel Power :</strong> 프레넬 영역 제어</li>\n<li><strong>Fresnel Intensity :</strong> 프레넬 밝기 제어</li>\n<li><strong>GGX Specular :</strong> 미세분포함수로 GGX를 사용. 디폴트는 Blinn-Phong</li>\n<li><strong>Specular Glossiness :</strong> 스펙큘러 번들거림 제어</li>\n<li><strong>Specular Intensity :</strong> 스펙큘러 밝기 제어</li>\n<li><strong>IBL Exposure :</strong> CubeMap Reflection 밝기 제어</li>\n<li><strong>IBL Blur Amount :</strong> CubeMap Reflection 흐려짐 제어</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>커스텀 서피스 셰이더의 워크플로우</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABN0lEQVQoz42Ry0rDQBSG+/57wY0uVSwK2tqiCze+gLeFShU1NW1iZpLmTDLJTNJPIl4qInjgcO7f4j89gOVy2QWaZkmiUqyt+cu6Va0zjLF8nLHK6HXJZ1HXOXH8RGUT6krhfY5zgvcLGp/S+AzvhTSbURYxda3eZ23jv6C9T5jzwmu0hUq2yc0xSTqkKA+oyj5SDFnICQsZY2SXwvRZ5CNUOiaXfay9+wC238DaZcSzNcL5DnfxhMvwligbYWWdx/iM6/kDt9EVebZJpje4mV1wGdwzVadU9vw30HlDEvVJ9S5lOcKYIdYe4t0hZTnAmCOKYoiru94AkQGZHlCYPSo7+QauCppXhkASpkbxYhShaALRhKZzRdC5aKaiiSQmeL3Bu5K2bX9quPqY/5prHaF5/vHlDvgGZ7UVtqLmTuAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UnitySubstance_img19\"\n        title=\"UnitySubstance_img19\"\n        src=\"/static/815ec2afda5cf8fe70b7b5f904b91269/37523/UnitySubstance_img19.png\"\n        srcset=\"/static/815ec2afda5cf8fe70b7b5f904b91269/e9ff0/UnitySubstance_img19.png 180w,\n/static/815ec2afda5cf8fe70b7b5f904b91269/f21e7/UnitySubstance_img19.png 360w,\n/static/815ec2afda5cf8fe70b7b5f904b91269/37523/UnitySubstance_img19.png 720w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>버텍스 셰이더는 생략 (필요하다면 꺼내 쓸 수 있음)</li>\n<li>픽셀 셰이더는 Surf 함수와 Lighting 함수로 나뉘어진다.</li>\n<li>Surf에서는 텍스쳐 샘필링 및 노멀 Z계산, 메탈릭 디퓨즈 계산</li>\n<li>다른 Reflection 처리는 전부 Lighting 함수로 넘겨서 계산</li>\n</ul>\n</li>\n<li>\n<p><strong>분기, 전처리</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">CGPROGRAM\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">surface surf PBR fullforwardshadows nolightmap noforwardadd nometa nolppv noshadowmask nodynlightmap</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">shader_feature __ _USEPBRSETTING_ON</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">shader_feature __ _USEGGXSPECULAR_ON</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">shader_feature __ _USEFRESNEL_ON</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">shader_feature __ _USESPECULAR_ON</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">shader_feature __ _USEIBL_ON</span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">_USEPBRSETTING_ON</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_NormalStrength</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_LambertToHalf</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_FresnelPower</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_FresnelIntensity</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_SpecularGloss</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_SpecularIntensity</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_IblExposure</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_IblBlurAmount</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<ul>\n<li>필요한 옵션을 적당히 넣으면 된다. Lightmap이 필요하면 해당 옵션을 지운다든지</li>\n<li>전처리로 인한 성능향상은 생각보다 크지 않다</li>\n<li>각종 최적화용 분기 따로 만들어 둠</li>\n<li>편의용 분기도 따로 만들어 둠 ( 옵션을 사용하지 않으면 기본값으로 자동으로 돌아감 )</li>\n</ul>\n</li>\n<li>\n<p><strong>Surf 함수에서 해야 하는 일</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token keyword\">void</span> <span class=\"token function\">suf</span> <span class=\"token punctuation\">(</span>Input IN<span class=\"token punctuation\">,</span> <span class=\"token keyword\">inout</span> SurfaceOutputPBR o<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">half4</span> MainTex <span class=\"token operator\">=</span> <span class=\"token function\">tex2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> IN<span class=\"token punctuation\">.</span>uv_MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half4</span> PBRTex <span class=\"token operator\">=</span> <span class=\"token function\">tex2D</span><span class=\"token punctuation\">(</span>_PBRTex<span class=\"token punctuation\">,</span> In<span class=\"token punctuation\">.</span>uv_MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                  <span class=\"token comment\">// 텍스쳐 샘플링</span>\n\t\to<span class=\"token punctuation\">.</span>Metallic <span class=\"token operator\">=</span> PBRTex<span class=\"token punctuation\">.</span>b <span class=\"token operator\">*</span> _MetallicAmount<span class=\"token punctuation\">;</span>                       <span class=\"token comment\">// _MetallicAmount 프로퍼티로 제어 가능하게 세팅</span>\n\t\to<span class=\"token punctuation\">.</span>Smoothness <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> MainTex<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> _RoughnessAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 스무스니스는 러프니스 반전값으로 사용</span>\n\t\to<span class=\"token punctuation\">.</span>Occlusion <span class=\"token operator\">=</span> PBRTex<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">;</span>\n\t\to<span class=\"token punctuation\">.</span>Albedo <span class=\"token operator\">=</span> MainTex<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> _Color<span class=\"token punctuation\">.</span>rgb<span class=\"token punctuation\">;</span>\n\t\to<span class=\"token punctuation\">.</span>LumaAlbedo <span class=\"token operator\">=</span> <span class=\"token function\">Luminance</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>Albedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                            <span class=\"token comment\">// float3 Albedo를 float값으로 계산해놓음</span>\n\n\t\t<span class=\"token keyword\">float3</span> unpackedNormal<span class=\"token punctuation\">;</span>\n\t\tunpackedNormal<span class=\"token punctuation\">.</span>xy <span class=\"token operator\">=</span> PBRTex<span class=\"token punctuation\">.</span>ga <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>                         <span class=\"token comment\">// Normal XY를 -1 ~ 1 값으로 리매핑</span>\n\t\tunpackedNormal<span class=\"token punctuation\">.</span>z <span class=\"token operator\">=</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token function\">saturate</span><span class=\"token punctuation\">(</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>unpackedNormal<span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> unpackedNormal<span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// Normal XY 값으로 Z를 구한다</span>\n\t\to<span class=\"token punctuation\">.</span>Normal <span class=\"token operator\">=</span> unpackedNormal <span class=\"token operator\">*</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>_NormalStrength<span class=\"token punctuation\">,</span> _NormalStrength<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>             <span class=\"token comment\">// 노멀 강도 조절하는 옵션 추가</span>\n\n\t\t<span class=\"token comment\">// 메탈릭에 따른 디퓨즈 감소현상. 어두워지는 부분이라 Surf에서 구현. 러프니스 영향도 함께 받도록 구현</span>\n\t\to<span class=\"token punctuation\">.</span>Albedo <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span>Albedo <span class=\"token operator\">*</span> _DiffuseBoost <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.25</span><span class=\"token punctuation\">,</span> o<span class=\"token punctuation\">.</span>Smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.05</span><span class=\"token punctuation\">,</span> o<span class=\"token punctuation\">.</span>Smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>Metallic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>실질적인 리플렉션 구현은 Lighting 함수 안에 배치. Surf에서는\n<ul>\n<li>텍스쳐 샘플링 및 서피스 아웃풋 연결</li>\n<li>노멀 z를 구하고 노멀 강도 조절하는 프로퍼티 연결</li>\n<li>메탈릭 속성을 띄면 프레넬이 증가하며 Diffuse반사가 거의 없어지는 부분 처리 ( Lighting 함수에서 계산하면 충분히 어두워지지 않는다)</li>\n<li>러프니스 값에 따라 디퓨즈 영향이 바뀌는 부분은 그냥 <red>눈으로 맞춤</red></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Lighting 함수에서 해야 할 일들</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token keyword\">half4</span> <span class=\"token function\">LightingPBR</span> <span class=\"token punctuation\">(</span>SurfaceOutputPBR s<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> lightDir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> viewDir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half</span> atten<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">half4</span> c<span class=\"token punctuation\">;</span>\n\t\tflaot3 halfVector <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>lightDir <span class=\"token operator\">+</span> viewDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> ndotl <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>Normal<span class=\"token punctuation\">,</span> lightDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> ndoth <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>Normal<span class=\"token punctuation\">,</span> halfVector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> ndotv <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>Normal<span class=\"token punctuation\">,</span> viewDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> halfLambert <span class=\"token operator\">=</span> ndotl <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> fresnelSrc <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ndotv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">float</span> smoothness <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>Smoothness<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> sqrtSmoothness <span class=\"token operator\">=</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> metallic <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>Metallic<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> occlusion <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>Occlusion<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> lumaAlbedo <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>LumaAlbedo\n\n\t\t<span class=\"token punctuation\">.</span>\n\t\t<span class=\"token punctuation\">.</span>\n\t\t<span class=\"token punctuation\">.</span></code></pre></div>\n<ul>\n<li>디퓨즈 계산을 위한 <code class=\"language-text\">ndotl</code>, 스펙큘러 계산을 위한 <code class=\"language-text\">ndoth</code>, 프레넬 계산을 위한 <code class=\"language-text\">ndotv</code>를 미리 구해둔다.</li>\n<li><code class=\"language-text\">SurfaceOutputPBR</code>으로부터 넘어온 값을 미리 변수에 담아둠.</li>\n</ul>\n</li>\n<li>\n<p><strong>Lighting 함수 - Diffuse Reflection</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// Diffuse Reflection</span>\nc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">=</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>Albedo <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ndotl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> halfLambert<span class=\"token punctuation\">,</span> _HalfLambert<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token operator\">*</span> <span class=\"token number\">1.4</span> <span class=\"token operator\">*</span> _LightColor0<span class=\"token punctuation\">.</span>rgb<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">.</span>Albedo <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.75</span><span class=\"token punctuation\">,</span> lumaAlbedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span> \n\t\t\t\t<span class=\"token operator\">*</span> occlusion <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> atten<span class=\"token punctuation\">,</span> _ShadowAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 비금속은 디퓨즈 계산. 금속은 디퓨즈 계산 안함</span>\n<span class=\"token comment\">// atten을 넣어야 셀프 섀도우 발생. </span>\n<span class=\"token comment\">// 섀도우 어마운트 값을 내리면 1이 곱해지게 되어 섀도우가 없어진다.</span></code></pre></div>\n<ul>\n<li>난반사는 <code class=\"language-text\">ndotl</code>을 이용한 <red>램버트모델</red>로 구현</li>\n<li>하지만 섭스 셰이더를 눈으로 봤을때는 <red>하프램버트</red>에 가까움</li>\n<li>눈으로 봤을 때 비슷하니 하프램버트로 구현하되 램버트와 보간 가능하도록 설정</li>\n<li>어차피 만들어두면 음영이 강하게 지는 낮시간대 / 음영이 약한 밤 시간대 제어를 할 수 있으니 프로퍼티로 빼둠</li>\n<li>Surf 함수에선 금속성 때문에 어두워지는 처리만 해 주었다면, Lighting 함수에서는 Lambert 디퓨즈 리플렉션 계산을 해준다</li>\n<li>Shadow 보간 처리도 해준다.</li>\n</ul>\n</li>\n<li>\n<p><strong>Lighting 함수 - CubeMap Reflection</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">\t<span class=\"token comment\">// Cubemap Reflection</span>\n\t<span class=\"token keyword\">float4</span> hdrReflection <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">_USEIBL_ON</span></span>\n\t<span class=\"token keyword\">float3</span> reflectedDir <span class=\"token operator\">=</span> <span class=\"token function\">reflect</span><span class=\"token punctuation\">(</span><span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>viewDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 리플렉트벡터 구함</span>\n\t<span class=\"token keyword\">float4</span> reflection <span class=\"token operator\">=</span> <span class=\"token function\">UNITY_SAMPLE_TEXCUBE_LOD</span><span class=\"token punctuation\">(</span>unity_SpecCube0<span class=\"token punctuation\">,</span> relfecedDir<span class=\"token punctuation\">,</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> _IblBlurAmount<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sqrtSmoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 큐브맵 샘플링</span>\n\t<span class=\"token comment\">// 러프니스가 증가할수록 Texcube의 LOD단계가 증가함. 0일때 가장 선명함. sqrtSmoothness를 쓴 이유는 블러 값이 천천히 진행되도록 하기 위함. (반전이라 sqrt가 초반가중치)</span>\n\t<span class=\"token comment\">// _IblBlurAmount -1을 해준 이유는 인스펙터 초기값을 1로 맞추기 위함.</span>\n\thdrReflection<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">DecodeHDR</span><span class=\"token punctuation\">(</span>reflection<span class=\"token punctuation\">,</span> unity_SpecCube0_HDR<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span> <span class=\"token operator\">*</span> _IblExposure <span class=\"token operator\">*</span> occlusion<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// HDR소스는 HDR디코딩을 해 주엉야 색이 제대로 나온다</span>\n\t<span class=\"token comment\">// 오클루전은 큐브맵에만 곱해주면 프레넬에서는 따로 곱해줄 필요 없음</span>\n\t<span class=\"token keyword\">float3</span> metalRefl <span class=\"token operator\">=</span> hdrReflection<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.75</span><span class=\"token punctuation\">,</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>lumaAlbedo<span class=\"token punctuation\">,</span> <span class=\"token number\">2.2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 금속성일 때 리플렉션</span>\n\t<span class=\"token keyword\">float3</span> nonNetalRefl <span class=\"token operator\">=</span> hdrReflection<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.05</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.025</span><span class=\"token punctuation\">,</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>lumaAlbedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 비금속일 때 리플렉션</span>\n\t<span class=\"token keyword\">float</span> finalRefl <span class=\"token operator\">=</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span>nonMetalRefl<span class=\"token punctuation\">,</span> metalRefl<span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                            <span class=\"token comment\">// 금속 / 비금속 처리</span></code></pre></div>\n<ul>\n<li>러프니스가 강해지면서 리플렉션이 블러리하게 보이는 것은 멀티 샘플링이 아니라 <red>밉맵(LOD)</red>을 활용</li>\n<li>리니어하게 하면 블러 단계가 초반에 확 일어나므로 <code class=\"language-text\">sqrtSmoothness</code>를 이용 (Roughness는 Smoothness의 반전값이라 sqrt가 초반가중치)</li>\n<li>큐브맵이 HDR소스라면 HDR디코딩을 해야 색이 제대로 나온다.</li>\n<li>편의를 위해 메탈 / 논메탈로 나누어 계산. 논메탈은 나중에 어두운 거친 표면 표현때 또 쓰임</li>\n<li>애매한 부분은 <red>눈으로 맞춤</red></li>\n</ul>\n</li>\n<li>\n<p><strong>Lighting 함수 - Fresnel</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">\t<span class=\"token keyword\">float3</span> finalFresnel<span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">_USEFRESNEL_ON        </span><span class=\"token comment\">// shader_feature로 분기</span></span>\n\t<span class=\"token comment\">// fresnel</span>\n\t<span class=\"token keyword\">float3</span> fresnel <span class=\"token operator\">=</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>fresnelSrc<span class=\"token punctuation\">,</span> _FresnelPower <span class=\"token operator\">*</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> hdrReflection<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> <span class=\"token number\">0.375</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">float3</span> metalFresnel <span class=\"token operator\">=</span> fresnel <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.22</span><span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.05</span><span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> lumaAlbedo<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _FresnelIntnsity<span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">// 금속일때는 베이스컬러가 어두워질수록 프레넬이 없어짐</span>\n\t<span class=\"token keyword\">float3</span> nonMetalFresnel <span class=\"token operator\">=</span> fresnel <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.05</span><span class=\"token punctuation\">,</span> lumaAlbedo<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _FresnelIntensity<span class=\"token punctuation\">;</span>\n\tfinalFresnel <span class=\"token operator\">=</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span>nonMetalFresnel<span class=\"token punctuation\">,</span> metalFresnel<span class=\"token punctuation\">,</span> <span class=\"token function\">smoothstep</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span>atten<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\tfinalFresnel <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">1-NdotV</code> 계산 (<code class=\"language-text\">fresnelSrc</code>)에 <code class=\"language-text\">Pow</code>를 3정도 주고 (프로퍼티에서 0~6까지 조절가능하도록) 그냥 허옇게 더해지는 것이 아니므로 큐브맵 리플렉션을 곱해준다.</li>\n<li>금속 / 비금속일 때, 베이스컬러가 어두울 때 밝을 때에 따라 예외 상황이 많음</li>\n<li>위의 숫자들은 각 상황별로 <red>눈으로 맞추면서 조절</red></li>\n<li>아예 제어하기 쉽게 금속성 프레넬과 비금속성 프레넬 두 가지로 나눠서 구현</li>\n<li>마지막 atten과 1을 0.5로 보간한 것은 그림자 부분에서 프레넬이 너무 밝게 나와서 이상해지는 문제를 해결하기 위해 암부에 보정값을 넣은 것</li>\n</ul>\n</li>\n<li>\n<p><strong>Lighting 함수 - Specular</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">\t\t<span class=\"token comment\">// Specular</span>\n\t\t<span class=\"token keyword\">float3</span> specularLight<span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">_USESPECULAR_ON</span></span>\n\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">_USEGGXSPECULAR_ON    </span><span class=\"token comment\">// shader_feature로 분기</span></span>\n\t\t<span class=\"token keyword\">float</span> NdotH_2 <span class=\"token operator\">=</span> ndoth <span class=\"token operator\">*</span> ndoth<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> roughness_2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float</span> FinalGGX <span class=\"token operator\">=</span> roughness_2 <span class=\"token operator\">/</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>NdotH_2 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>roughness_2 <span class=\"token operator\">-</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// UnityStandardBRDF 구현과 동일</span>\n\t\tspecularLight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> FinalGGX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness <span class=\"token operator\">+</span> <span class=\"token number\">0.00001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.1</span> <span class=\"token operator\">*</span> _SpecularGloss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _SpecularIntensity <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness <span class=\"token operator\">+</span> <span class=\"token number\">0.00001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> sqrtSmoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> lumaAlbedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span>                    <span class=\"token comment\">// Blinn-Phong</span></span>\n\t\tspecularLight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ndoth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">64</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness <span class=\"token operator\">+</span> <span class=\"token number\">0.00001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.002</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> sqrtSmoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>lumaAlbedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _SpecularGloss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _SpecularIntensity <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness <span class=\"token operator\">+</span> <span class=\"token number\">0.00001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">// 스펙큘러 파워가 올라갈수록 인텐시티도 같이 올라가게 하여 에너지 보존을 구현. Albedo가 밝을때는 스펙큘러도 함께 밝아지는 것도 구현</span>\n\n\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\t\tspecularLight <span class=\"token operator\">=</span> specularLight <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token function\">Luminance</span><span class=\"token punctuation\">(</span>_LightColor0<span class=\"token punctuation\">.</span>rgb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>_LightColor0<span class=\"token punctuation\">.</span>rgb<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> s<span class=\"token punctuation\">.</span>Albdeo<span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> occlusion<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">// 금속 - 비금속 스펙큘러 컬러 처리</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\tspecularLight <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<ul>\n<li>스펙큘러는 성능에 따라 두 가지 옵션 중 선택가능하게\n<ol>\n<li>Blinn-Phong</li>\n<li>GGX</li>\n</ol>\n</li>\n<li>금속 / 비금속에 따라 스펙큘러 컬러 달라지는 것을 적용</li>\n<li>유니티(감마) 스탠다드 GGX 코드는 섭스턴스에 비해서 좀 과하므로 감쇠계산을 추가해줌</li>\n<li>라이트로 인한 스펙큘러가 거의 티가 나지 않을때는 최적화 옵션으로 꺼주면 된다</li>\n</ul>\n</li>\n<li>\n<p><strong>Lighting 함수 - Specular : Conservation of Energy</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">specularLight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ndoth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">64</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness <span class=\"token operator\">+</span> <span class=\"token number\">0.00001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.002</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> sqrtSmoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>lumaAlbedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _SpecularGloss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _SpecularIntensity <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> smoothness <span class=\"token operator\">+</span> <span class=\"token number\">0.00001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> metallic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">1 / (1 - smoothness)</code>를 해주어 Roughness 수치를 낮게 가져갈수록 스펙큘러 영역이 아주 작은 부분까지 줄어들도록 구현</li>\n<li>스펙큘러 글로스니스가 올라갈수록 인텐시티도 같이 올라간다 (에너지 보존 구현)</li>\n<li>Roughness나 Metallic에 따른 보정값 계산 (눈으로 맞춤)</li>\n</ul>\n</li>\n<li>\n<p><strong>Lighting 함수 - Roughness (Smoothness) 기반 병합</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// 최종 합성</span>\nc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>finalFresnel <span class=\"token operator\">+</span> specularLight<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span> lumaAlbedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                                 <span class=\"token comment\">// 베이스컬러가 밝을수록 라이팅은 감소. ibl 빼고 다 계산해둠</span>\n\nc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">=</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> nonmetalRefl <span class=\"token operator\">*</span> <span class=\"token function\">leerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> lumaAlbedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>                            <span class=\"token comment\">// 스무스니스 정도에 따라 난반사 양 조절</span>\n\t\t\t\tfinalRefl<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> <span class=\"token function\">lerp</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span> lumaAlbedo<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>specularLight <span class=\"token operator\">+</span> finalFresnel <span class=\"token operator\">+</span> c<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// 이 부분은 딱히 이론이 없음. 눈에 보이는 대로</span>\n\t\t\t\tsmoothness <span class=\"token operator\">*</span> smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                                                                    <span class=\"token comment\">// 스무스니스 정도에 따라 리픅렉션 정도를 제어한다 정도로 생각하면 될 듯</span></code></pre></div>\n<ul>\n<li>1항은 IBL을 제외하고 전부 계산. (러프니스가 1일때이므로 IBL이 나오지 않음)</li>\n<li>2항은 IBL 위주로 계산</li>\n<li>어두운 비금속의 살짝 밝아지는 표현을 위해 <code class=\"language-text\">nonmetalRefl * leerp(0.5, 0, lumaAlbedo)</code>계산을 추가로 해줌</li>\n<li>3항에서 두번 곱하는 것은 1항에 가중치를 두기 위함</li>\n<li>위 코드는 최적화 여지가 좀 더 있음</li>\n</ul>\n</li>\n</ul>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%9C%A0%EB%8B%88%ED%8B%B0-pbr\">유니티 PBR</a></li>\n<li><a href=\"#%EA%B0%84%EB%8B%A8-pbr-%EA%B0%9C%EB%85%90\">간단 PBR 개념</a></li>\n<li><a href=\"#%EB%9D%BC%EC%9D%B4%ED%8C%85-%EB%AA%A8%EB%8D%B8\">라이팅 모델</a></li>\n<li><a href=\"#%EC%BB%A4%EC%8A%A4%ED%85%80-pbr-%EA%B5%AC%ED%98%84-%EC%A4%80%EB%B9%84\">커스텀 PBR 구현 준비</a></li>\n<li><a href=\"#%EA%B5%AC%ED%98%84-%EA%B2%B0%EA%B3%BC\">구현 결과</a></li>\n</ul>\n</div>","excerpt":"모바일에서 사용 가능한 유니티 커스텀 섭스턴스 PBR 쉐이더 만들기 군생활 중, NDC 2019 발표를 보면서 단순 정리한 내용입니다. 노션에 작성했던 내용을 블로그로 옮겨 작성해, 가독성에 문제가 있을 수 있습니다. ※주의 : 본 내용은 아주 기술적인 이야기는 아니며, 기술보다는 꼼수를 이용한 문제해결 이야기입니다. 약 38:35 정도까지 작성되었습니다. ▶ NDC Replay - 발표 자료 링크 유니티 PBR 리니어 스페이스와 감마 스페이스 사실 리니어 스페이스가 맞는 값 하지만 어두운 곳에 민감한 사람 눈은 이것을 선형적으로 인지하지 않는다. 이것을 감마 코렉션 (2.2제곱)하여 선형적으로 보이게끔 한 것 Unity ColorSpace Default Setting : Gamma \n\n 유니티와 섭페를 비교해보며 알 수 있었던 것 유니티 감마는 물론이고 리니어도 섭스턴스 페인터와 동일하지 않다. 결과값이 다르게 나오는 걸 보면 서로서로 구현도 다르다는 것을 알 수 있다. 즉, 물…","frontmatter":{"date":"August 09, 2022","title":"Unity Custom Substance PBR Shader","categories":"STUDY","author":"JunHyeong Moon","emoji":""},"fields":{"slug":"/Study/UnityCustomPbr/"}},"next":null,"prev":{"id":"f8ac93c6-e82e-5613-b370-ecd28f9e5010","html":"<p><strong>Deep Dive into the URP Lighting</strong></p>\n<blockquote>\n<p>군 생활 중, Unity Dev Week 에서 진행한 <strong>URP 셰이더 뜯어보기</strong>를 단순 정리한 내용입니다.<br>\n노션에 작성했던 내용을 블로그로 옮겨 작성해 가독성에 문제가 있을 수 있습니다.</p>\n<p><em>약 1:17:35 정도까지 작성되었습니다.</em></p>\n</blockquote>\n<div style=\"position: relative; width: 100%; padding-bottom: 56.25%\">\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/9K1uOihvNyg?si=FaLQlK6cD0FDZE9o\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen style=\"position: absolute; width:100%; height: 100%;\"></iframe>\n</div>\n<div style=\"margin-top: 12px\"> </div>\n<p><a href=\"https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.universal/ShaderLibrary\">▶ <strong>Unity ShaderLibrary</strong> Github 링크</a></p>\n<hr>\n<h3 id=\"urp-왜-써야-할까요\" style=\"position:relative;\"><a href=\"#urp-%EC%99%9C-%EC%8D%A8%EC%95%BC-%ED%95%A0%EA%B9%8C%EC%9A%94\" aria-label=\"urp 왜 써야 할까요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>URP 왜 써야 할까요?</h3>\n<p><strong>Universal Render Pipeline</strong></p>\n<ul>\n<li>Unity 2020부터 기본 파이프라인이 Legacy → URP 방식으로 변화</li>\n<li>URP에서는 기존 Legacy 방식의 셰이더 (Surface, Fragment) 들을 지원하지 않는다.</li>\n<li>URP 방식으로 넘어가야 하는 것은 시대의 변화. 힘들어도 받아들이는 수 밖에!</li>\n<li>하지만 그걸 받아들이기 전에 어떤 것들이 좋아졌길래 바뀌어야 하는지 정도는 알고 넘어가자!</li>\n<li>오늘 세션에서는 HDRP에 대한 내용은 다루지 않음.</li>\n</ul>\n<p><strong>레거시와 URP의 장단점 / Legacy vs URP</strong></p>\n<ul>\n<li>\n<p><strong>Legacy</strong></p>\n<ul>\n<li>손쉽게 셰이더 코딩할 수 있는 환경 (서피스, 프레그먼트)</li>\n<li>노드방식 지원하지 않음</li>\n<li>다이나믹 배칭은 극히 제한적으로 사용 가능</li>\n<li>멀티 패스 렌더링에 별다른 제약 없음</li>\n<li>렌더 시점에 대한 별로 큰 고민 안함 (그랩패스 등…)</li>\n</ul>\n</li>\n<li>\n<p><strong>URP</strong></p>\n<ul>\n<li>다소 복잡해진 셰이더 코딩 환경 (HLSL)</li>\n<li>노드 방식 지원</li>\n<li><red>SRP Batcher</red> 사용 가능</li>\n<li>멀티패스 렌더링 하려면 골치아픔</li>\n<li>렌더 시점에 대해서 고민이 필요함</li>\n<li>렌더 오브젝트, 렌더 피쳐 등 패스 추가 기능이 생겼음</li>\n</ul>\n</li>\n<li>\n<p>대략 큰 차이점은 이정도.</p>\n</li>\n<li>\n<p>이 중 특히 <red>SRP Batcher</red> 라는 기능이 추가되면서 Dynamic 오브젝트가 많아지더라도 좋은 퍼포먼스를 유지하는 것이 가능해졌다.</p>\n</li>\n</ul>\n<p><strong>SRP Batcher</strong></p>\n<div style=\"width: 100%; height: 100%; display: flex; flex-direction: row; gap: 10px;\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACj0lEQVQozy2S708aBxyH719qsldNmuz/WdO+60jWZOmSusZG19TUtVtmRrpZxaZYdbQ6RQvIKXDcCRwc9wMORLhfIIdmFnzxNNK9ePLk++aT74tHSMtNMnITxQiQrUtM54rrfkAvK9JIpTAO9vELecbhELV1gljap6iLNLza/1Sntrwabb+J8CzeYGGjyatEm92TC2rdMRO3yyCTpp89JDjMMBRFPg/61H0VuSVS6uRQnSJVR0btfXXFkbC8OsI393PcubfLtxGF1/s+ljdh7HYZFfJcnihTLiSJq0Gf9qhJY6Bhn+sYQZWaq6B7J5hBCc2TaXg6wq3vRG7f3eFOpMof2x3Udjgd7MRiOGsxurFV/GSSyTAkYyZZ3H7CwtYMcSmK5pbJNQqktGMkO0fLNxC+/13lYVTnp790/lVCSnbIecNEf/4ca34O8+lTTldWOXcc9ipbPHkX4fHqA16nFynZedayKV4kkryX0rT7BsLLdyVevFXYOuqRqYbktICmLFGYneWfyAPER4+oR6O0DIODWoLZ+A/MrEb4W/wNUT1g6eMWPy+/5X0hQyswEH5ZkZlbLrK8a7EjuRSMAePeGebCAvX5ecy5ObqxNS68gO3SOj++uc/D6F2WDp5ROS2yfpzm1w97bOTTtAIdYTFe5eWGRjzbI1UZonY+M3F7dDY3cRIJupubuHt7TMKQvJ0lJv45Zae8juaVUU6LSHYBpVPAvvlwJprl8VKWlWSLT+UQtTPm2ukSHh0xKkqMpAKjfI6rvo89NDGDCuagiu6VvybjylQ9GdWVaPp1hI+5Mz4cn3FYGaA0/5tmcx34XNwko1a4rNxQZhye0wltLF/DCuqYN+7rNPr69LYCjbOBzRds6KP/EnNIXwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SRP_Batcher01\"\n        title=\"SRP_Batcher01\"\n        src=\"/static/c25e5b59c5e7bde3ab5a21d8edf6a2d8/37523/URP_img001.png\"\n        srcset=\"/static/c25e5b59c5e7bde3ab5a21d8edf6a2d8/e9ff0/URP_img001.png 180w,\n/static/c25e5b59c5e7bde3ab5a21d8edf6a2d8/f21e7/URP_img001.png 360w,\n/static/c25e5b59c5e7bde3ab5a21d8edf6a2d8/37523/URP_img001.png 720w,\n/static/c25e5b59c5e7bde3ab5a21d8edf6a2d8/cab8c/URP_img001.png 744w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACsklEQVQozx3RXU9TBwCA4fOf3O7dzX6EF7tZdMmWaIAMjDGLiBuWmVAFS5RaBkVEu4IeaGEMKO3px+nnKZZCaUtpj/0+Zf2iPSVevItePHl/wCt44wW+CCbLJAo9Tko6fa1OJRigEPCT80poSox+u0E4LSMd7hPJBEhrSU61I1K1BKlqgqx2QkdvI9wyJvhpOs7N6QQr7gaJT1f0SmVS5nmkxwbkqT8piyKdRgWLb5rJjWEe2UcwbIx99dgxypw0QTB3QGfQQvhmKMa3t0Su3Qlj+LtI7KxJNZ0hOfOM3Xv3CD4cR11+TVnNYT4wYnQ8wLgxjnHzATPOCZ5uTvB0e4JAdo/eVQfh+liY70ddfHc3yjOxxNEnnWa+QG7OxM7Yr4QejlN6vUK3Wcd5uI7Nb8EuL2J1PWfZbeKN9wWrPjOK6qejNxHW/DXWZI0vPUi0iRcG6FqD/wIBKh43NUmiFY0yuGzhOt7C8s8s7wILxFWZw/MQsTM/J2WF06pCu3+BsOBMY1pL8talEkhdouR1uvU6hUiE81iETDhEPhzlc7/LX/uz/Gy8wf3FX/ClXWzGZN753dhliQ9hD1qnjmBaTzJljbCwlUVKtonldXrFEqdvVvm4uIRiWSAnbqK3GljdLxiZu8mk7S7bMQdLHh/TH5zMOnaYd3lQ6xWEWZvC1FII6845vuMO0VyPlqpyPj+PYjCQfPKEis2G3r1g1W9h2PQjk/ZRXMl/WfEFMYrbPHfuYj6QULUqgvGtwiOLzCtnFu9xFyU/oFXII//xO47hIbZHhsiaX/G532LZ+5LbMz/wm/U2UmoPMexlLSTxPuJl1bdL6aKGsBOt4ggW2Y9rRM96HBev6FerVLYcFMX3FMV1anu7DC6bBM88rPtWcEbsnFQOyV2kyNSPyGpHZOofv17+H7LBiawO+8bEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SRP_Batcher01\"\n        title=\"SRP_Batcher01\"\n        src=\"/static/fa8d6152ebda95bf32014645a2a8d6a0/37523/URP_img002.png\"\n        srcset=\"/static/fa8d6152ebda95bf32014645a2a8d6a0/e9ff0/URP_img002.png 180w,\n/static/fa8d6152ebda95bf32014645a2a8d6a0/f21e7/URP_img002.png 360w,\n/static/fa8d6152ebda95bf32014645a2a8d6a0/37523/URP_img002.png 720w,\n/static/fa8d6152ebda95bf32014645a2a8d6a0/d125e/URP_img002.png 737w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</div>\n<ul>\n<li>Per Object Large Buffer 가 추가되었다.</li>\n<li>이는 머티리얼에서 변화가 필요한 부분만 CBUFFER에 넣어놓고 나머지 머티리얼 콘텐츠를 GPU 메모리에 유지 (Per Object Large Buffer) 시키고 그 계산을 재사용하는 방식</li>\n<li>Batcher라는 이름을 달고 있지만 사실 정말 배칭을 해주는 (드로우 콜이 줄어드는) 기능은 아니다.</li>\n<li>드로우 콜이 발생할 때 렌더 스테이트를 올리는 비용을 재사용을 통해 줄여주어 사실상 배칭과 거의 비슷한 퍼포먼스를 내게 해준다.</li>\n<li>CPU Instancing과 퍼포먼스 비교시, GPU Instancing이 미세한 차이로 조금 빠르기는 하나, GPU Instancing은 메시가 동일해야하지만, SRP Batcher는 메시가 틀려도 사용 가능하기 때문에 SRP Batcher 판정승</li>\n</ul>\n<p><strong>URP는 확실히 좋다! 그치만…!</strong></p>\n<ul>\n<li>확실히 빨라집니다. (레거시 때 10프레임 나오던 프로젝트가 URP 전환 후 50프레임이 되기도)</li>\n<li>하지만 기존에 했던 방식과 호환이 안되고, 새로운 방식을 학습해야하는 문제가 있다.</li>\n<li>셰이더 그래프라는 ‘손쉽게’ 셰이더를 작성할 수 있는 도구도 있음.</li>\n</ul>\n<p><strong>그렇게 만져본 셰이더 그래프</strong></p>\n<ul>\n<li>UX는 좀 불~편</li>\n<li>단축키도 없고, 그룹 안에서 노드 생성 불가능하고, 컴포넌트 마스크도 없고, UV는 무조건 float4고… 등등등</li>\n<li>근데 컬링이 없어서 코드로 생성하고 바꿔줘야 한다…?</li>\n<li>어라…? 블렌드 모드를 넣을 수도 없다…?</li>\n<li>당연히 Zwrite, Ztest, 스텐실 등의 옵션도 사용하지 못한다…?</li>\n<li>그리고 노드 크기가 너무 크다…</li>\n</ul>\n<p><strong>그 외 불편했던 점들…</strong></p>\n<ul>\n<li>Unlit Master는 Receive Shadow가 안먹고 Ambient도 안먹고 심지어 Fog 까지 안먹는다.</li>\n<li>아마도 이펙트 등에 사용하라고 이렇게 만든 것이겠지만 모든 사물을 굳이 PBR로만 만들어야 하다니…?</li>\n<li>PBR이 아닌 Stylized 스타일에서도 라이트 연산하려면 굳이 무거운 PBR 연산을 해야한단 말인가..?</li>\n<li>PBR Master는 그림자 색도 맘대로 못바꿈. 디퓨즈 라이팅 계산도 변경 불가</li>\n<li>NPR 프로젝트에서는 명암이 셀셰이드처럼 나와야 하기 때문에 PBR보다는 Unlit방식으로 작업을 해야함</li>\n<li>이렇게 Unlit이지만 Light Vector도 알고싶고, Shadow도 받고 싶고, Fog도 적용되게 하고싶을 때 어떻게 해야하나</li>\n<li>셰이더 그래프에서 Custom Node를 활용하면 라이트벡터와 섀도우는 어찌저찌 해결이 되기는 함. 하지만 이거나 코딩이나…</li>\n<li>Header, Space 등의 어트리뷰트도 넣을 수 없어서 머티리얼 창 가독성이 굉장히 떨어짐</li>\n<li>생성한 코드 또한 가독성이 무척 떨어짐. 자동으로 생성된 괴로운 변수명들</li>\n<li>텍스쳐 uv Tiling Offset 기본 [No ScaleOffset]으로 되어있음…?</li>\n<li>뎁스페이드를 Transparent로 사용할 때만 제대로 나옴</li>\n<li>그 외에 버텍스 셰이더 계산인지 픽셀 셰이더 계산인지 헷갈려 하는 상황이 발생하거나…</li>\n<li>레거시 방식에서 구현한 함수 등을 복붙하기 넘 괴로움…</li>\n<li>테셀레이션, 지오메트리 셰이더 사용 불가</li>\n<li>그리고 무엇보다 가장 중요한 글로벌 키워드 멀티컴파일이 동작하지 않는다!</li>\n</ul>\n<p><strong>셰이더 그래프의 좋은점도 있습니다</strong></p>\n<ul>\n<li>서브그래프 생성시 자동으로 변수들 만들어 주는 것도 괜찮고</li>\n<li>멀티컴파일, 키워드이넘 등 만들기 편하고</li>\n<li>float4를 float3에 연결했을 때 다이나믹하게 float3으로 연결</li>\n<li>웹상에 자료가 많은 편</li>\n<li>어 음… 더 있었던 것 같은데 기억이 나지 않는군요! 생각나진 않아도 더 있을 것 같습니다!</li>\n</ul>\n<p><strong>앞서 언급했던 문제들을 해결하려면..</strong></p>\n<ul>\n<li>그것은 바로 코딩으로 셰이더를 작성하는 것.</li>\n<li>HLSL 방식이라고는 하지만 Legacy에서 프레그먼트 셰이더를 작성해봤다면 생각보다 어렵지 않습니다!</li>\n<li>한편 서피스 방식 사용자에게는 슬픈 일이지만 몇 가지 신경써야 할 부분들이 있습니다.</li>\n<li>가장 큰 부분이 행렬. 서피스 방식은 행렬을 자동으로 계산해주었지만, 이제는 직접 해야한다.</li>\n<li>하지만 두려울 것은 없다. 그냥 코드 한줄 넣어주면 되기 때문. 일단 외워서라도 해 볼만 합니다</li>\n<li>버텍스 인풋 아웃풋에 조금 더 신경을 써주고, 버텍스 셰이더에서 각 데이터들에 값을 정확하게 잘 넣어주는 것이 중요</li>\n</ul>\n<p><strong>서피스, 프레그먼트 방식과 URP의 다른점</strong></p>\n<ol>\n<li>인클루드 파일이 <em>UnityCG.cginc</em> 하나에 다 들어있는 것이 아니라 여러가지 파일로 나뉘어져 있습니다.</li>\n<li>예전에는 베이스패스 하나만 작성하면 되었지만, HLSL에서는 섀도우캐스터, 뎁스온리 등 다른 패스도 작성해야 합니다.</li>\n<li>행렬 이름이 달라졌습니다 (이제 unity…로 시작하는 행렬 이름을 보지 않아도 된다!)</li>\n<li>텍스쳐 샘플링 코드가 달라졌습니다.</li>\n<li>CBUFFER라는 것이 생겼습니다.</li>\n<li>라이트를 여러 개 사용할 수 있고, 라이트 관련 코드가 많이 바뀌었습니다.  등 등…</li>\n</ol>\n<p><strong>1. 인클루드 파일 / Include</strong></p>\n<ul>\n<li><em>Lighting.hlsl</em> - 라이트 구조체, 디퓨즈, 스펙큘러 계산, GI (SH, 라이트맵)</li>\n<li><em>Shadows.hlsl</em> - 섀도우맵 샘플링, 케스케이드 계산, ShadowCoord 계산, Shadow Bias 계산 등</li>\n<li><em>Core.hlsl</em> - 버텍스 인풋 구조체 정의, 스크린 UV계산, 포그계산 등</li>\n<li><em>Common.hlsl</em> - 각종 수학관련 구현, 텍스쳐 유틸리티, 뎁스 계산 등</li>\n<li><em>SpaceTransforms.hlsl</em> - 각종 공간변환 행렬 정의, Tangent ↔ World 행렬이 추가되었음</li>\n<li><em>EntityLighting.hlsl</em> - SH, ProveVolume, Lightmap 계산 등</li>\n<li><em>ImageBasedLighting</em> - PBR에서 IBL 관련 부분만 떨어진 것. GGX, Anisotropy, ImportanceSample 등</li>\n</ul>\n<p>　</p>\n<div style=\"margin-top: -60px;\"></div>\n<ul>\n<li>Leagacy - <em>UniryCG.cginc</em> 안에 각종 계산, 행렬, 라이트, 뎁스, 포그, 패럴렉스 등 함수들이 모여 있습니다.</li>\n<li>URP - <em>Lighting.hlsl, Shadows.hlsl, Common.hlsl, SpaceTransforms.hlsl, Core.hlsl, EntityLighting.hlsl</em> 등 코드가 기능별로 분리되어 있습니다.</li>\n</ul>\n<p><strong>2. 패스 / Pass</strong></p>\n<ul>\n<li>Legacy - 섀도우 캐스터나 뎁스 등은 자동 생성되는 방식\n<ul>\n<li>멀티패스, 그랩패스 등에 대해서도 딱히 제약 없었습니다.</li>\n</ul>\n</li>\n<li>URP - 섀도우, 뎁스 패스는 물론이고 때론 meta, universal 2D 패스 등도 작성해 주어야 합니다.\n<ul>\n<li>하지만 크게 어렵지는 않습니다. 포지션만 잘 맞춰서 보내주면 됩니다.</li>\n</ul>\n</li>\n<li>그랩패스 같은거 하려면 복잡 - 불투명한 것만 가져오려면 CameraOpaqueTexture를 이용하면 되지만, 캡쳐 렌더타겟을 바꾸고 싶다면 c#을 이용하여 새로운 렌더타겟에 그릴 렌더패스를 작성해야 합니다.</li>\n</ul>\n<p><strong>3. 행렬 / Matrix</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// Fragment</span>\no<span class=\"token punctuation\">.</span>vertex <span class=\"token operator\">=</span> <span class=\"token function\">UnityObjectToClipPos</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// URP HLSL</span>\no<span class=\"token punctuation\">.</span>vertex <span class=\"token operator\">=</span> <span class=\"token function\">TransformObjectToHClip</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>서피스 방식으로 작업해 오던 사람에게는 좀 어려울 수도 있는 부분 (서피스는 행렬을 안써도 셰이더 작성이 가능)</li>\n<li>일단은 행렬을 원리부터 이해하려고 하지 말고 쉽게 접근해 봅시다.</li>\n<li>행렬은 쉽게 말하면 이동, 회전, 스케일을 해 주는 계산을 말합니다.</li>\n<li>그런데 그냥 이동 회전 스케일을 해주는 것이 아니라 이 계산을 통하여 중심축을 이동 회전 스케일 해준다고 생각하면 됩니다. 그렇게 중심이 바뀌면 ‘공간’을 ‘변환’했다고 말합니다 ( ex : 로컬공간 → 월드공간, 월드공간 → 뷰 공간 )</li>\n<li>로컬공간에 있는 오브젝트는 월드, 뷰 를 거쳐 클립공간에 이르게 됩니다.</li>\n<li>클립공간으로 변환해주는 행렬을 보면 기존과 방식이 달라졌음을 알 수 있습니다.</li>\n<li>Unity…로 시작하던 행렬들이 Transform…로 바뀐 점은 대단히 직관적이어서 확실히 좋은 점입니다.</li>\n</ul>\n<p><strong>4. 샘플링 / Sampling</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// UnityCG</span>\n<span class=\"token keyword\">half4</span> c <span class=\"token operator\">=</span> <span class=\"token function\">tex2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// URP HLSL</span>\n<span class=\"token keyword\">float4</span> c <span class=\"token operator\">=</span> <span class=\"token function\">SMAPLE_TEXTURE2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> sampler_MainTex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>텍스쳐, 큐브맵등을 샘플링하는 코드가 달라졌습니다.</li>\n<li>Sampler를 표시해주는 등 HLSL 표준 방식으로 변환 (그래도 샘플러 정의를 해 주는 부분은 없어서 좋음)</li>\n<li>예전보다 직관적인 것 같기도 한데, 타이핑 할 코드가 많아진 부분은 <del>조금</del> 불만</li>\n<li><code class=\"language-text\">tex2D(Texture Object, uv)</code> → <code class=\"language-text\">SAMPLE_TEXTURE2D(Texture Object, Sampler, uv)</code></li>\n<li><code class=\"language-text\">texCUBElod(Cubemap Object, float4(Reflection Vector, mipLevel))</code> → <code class=\"language-text\">SAMPLER_TEXCUBE_LOD(Cubemap Object, Sampler, Reflection Vector, mipLevel)</code></li>\n</ul>\n<p><strong>5. CBUFFER</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// UnityCG</span>\nsampler2D _MainTex<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">float4</span> _MainTex_ST<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">float4</span> _Color<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// URP HLSL</span>\n<span class=\"token function\">CBUFFER_START</span><span class=\"token punctuation\">(</span>UnityPerMaterial<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">TEXTURE2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">SAMPLER</span><span class=\"token punctuation\">(</span>sampler_MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">float4</span> _MainTex_ST<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">half4</span> _Color<span class=\"token punctuation\">;</span>\n\nCBUFFER_END</code></pre></div>\n<ul>\n<li>그냥 CBUFFER로 변수들을 감싸주면 끝</li>\n<li>CBUFFER로 감싼 변수들은 GPU 메모리 상에 업로드되어 SRP Batcher 계산을 위한 데이터로 쓰입니다.</li>\n<li>혹시 SRP Batcher를 사용하지 않고 GPU Instancing을 사용하고 싶다면 CBUFFER라고 쓰인 부분을 지워주면 됩니다.</li>\n<li>CBUFFER를 적어주면 SRP Batcher가 GPU Instancing보다 우선순위가 높기 때문에 SRP Batcher만 돌게 됩니다.</li>\n</ul>\n<p><strong>6. 라이트 / Light</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// UnityCG</span>\n<span class=\"token keyword\">half3</span> worldSpaceLightDir <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>_WorldSpaceLightPos0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// URP HLSL</span>\nLight mainLight <span class=\"token operator\">=</span> <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>shadowCoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>라이트 관련 처리가 가장 많이 바뀌었습니다.</li>\n<li>기존에는 1패스 당 1라이트 방식이었는데, 이제 1패스에 16개까지의 라이트를 한 번에 연산합니다.</li>\n<li>디렉션만 따로 받아올 수도 있지만, 구조체 방식으로 받아오는 것이 생각보다 코드 작성에 좋습니다.</li>\n<li>라이트 관련 처리가 바뀌면서 그림자에 대한 부분도 함께 바뀌었습니다.</li>\n<li>이 부분은 특히 가장 중요한 부분이니 후에 픽셀셰이더를 다룰 때 더 자세히 다루도록 하겠습니다.</li>\n</ul>\n<hr>\n<h3 id=\"셰이더-제작\" style=\"position:relative;\"><a href=\"#%EC%85%B0%EC%9D%B4%EB%8D%94-%EC%A0%9C%EC%9E%91\" aria-label=\"셰이더 제작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>셰이더 제작</h3>\n<p>자 그럼, 처음부터 하나하나 짚어가면서 CustomLighting 셰이더를 만들어봅시다</p>\n<p><strong>간단 렌더링 파이프라인</strong></p>\n<div style=\"width: 100%; height: 100%; display: flex; flex-direction: row; gap: 10px;\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC+ElEQVQozzWSS3PbNhSF9eu77jarZiabNDNZNBM7aUZxnDSt5Ui2zIdEUXwTJEWA7xcAggSQkeLe+bbnnjP3nkXeTGU7OwnWHaTZ5aNZHCNC8Cy44PMZMcuellkNEuSleZDmASzClkApxUJeRveaq2/Gu+X2052t2lWbY9yOFyjppiyPg8g2TM3xDo5nuoFVdEBIvhBS8mnukyg2DVt5SCyzBaBNW9Ix3Iy4obSdEIpQHlV15vlHhOKqRlntX5y5ZO0cHSpj7a++KMbaD3ZF4Xc4Jz3CfYZxPp4iH/h2HARHYxe4Thz6aWpzOi/kKHBHzWOlKNH9D8+0yjBkJSIUMzIwMowj5rAM4syGJbB8PYIuqkLY21PPFpLKrm4O3fhRd/64/vzZBPuGlbAnDcVnCG0nmPku2Ku7B8vZmY5+dHU02PPAFoIKMmAnLbdWdLvZ2aiLa8bYzIU4w7kUsqRB1CpxswsrNWr0uNXRaMz9tBAjZ60w1EZ/SDZ3gbaJ9YcCen2f4w7hLsekYHFsRYkF09A01ShyEQyTfDd17PyqGU+ZkzpPlnK3dVQb2fGAeo753E+0JqSaktT0oqcwPuyPay/UQWJEuSJmfhYLzqe26nLoHo3QMsIAqfvTVg+2OgApGbEA0PQTM0Xx7qD4wDkhAGpVSv5ckokLOrInRXNsVwvwPypcrpybDdB8TDseJHsPPp4q8wg2fqrG5R60j89iIeWTN/z11Xp9vb3619uFVAjxa6kQXHKZjweXffDZ0qV/e+PSY59ithJCPMeuYRbanqHowAnKBOEGTyOnA6uznvbch4qbaGmW7EzFj+wkC71i878z56wqChD4ez0HAcmyNutxN5J+7BuCmzk4Kc76rfbxtb78c/3+lXnzBlXf+Vl8SbjSwLsb/c3V6v0X/V5Lm5wMDcXtWJ7aLpss/x5tXoYfXvz36jft7e/V95cneM2lfD4YKgmAfZwNAPWwpNM4i18tuawu+gDA2+T0LYxvo+RrnN7CRhFS/gRmI2SgxpAQaAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RenderPipeline01\"\n        title=\"RenderPipeline01\"\n        src=\"/static/9313cb56a25739b1e3b7628b868c3d2e/dd45a/URP_img003.png\"\n        srcset=\"/static/9313cb56a25739b1e3b7628b868c3d2e/e9ff0/URP_img003.png 180w,\n/static/9313cb56a25739b1e3b7628b868c3d2e/f21e7/URP_img003.png 360w,\n/static/9313cb56a25739b1e3b7628b868c3d2e/dd45a/URP_img003.png 550w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABYUlEQVQY012Puy9DYRyGv+87PU30nAqpu+jN4eSURLXaUqJhcVlEiGojGEwszI2I/8FgsEh0EJeBwWQUsQmJySJhMhtMj7R1H558b773zZP8hJCCkBPAjlo4cRtfYy1CCDQpUFKUc+nPiXdiRzsIR4JoSqJEpVe/dmU03cXx3S5Xryfcvl8wvzH7WapPBNn1aW7ejrh83ufwfgehu38E/5FKEelrZ3RukvTUCImuJjL+KoaDJsNBg4zfQ7K7ieR4irHlLNF+i6Ggl0zAqGwCBiMhk3pT/5LKcvA2WFT3TLPS4+VlM8Z9YZC7QpqXzV5WEz4MZ4JYdovm1g6u1xwet4d4KAzwUEjxtJVg3DK+hAKpJLpLQ3h8zHTXcLYU5iBncbBgc74YJt/XjOYLYNa10NIWYm82xOFShGIuTDFvcbpsM+D3/Ah/o2sSr1thltBLWUNXfzeGWyt3plt+vy5VufQDBdy0KyRW1ugAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RenderPipeline01\"\n        title=\"RenderPipeline01\"\n        src=\"/static/7715d9caabac0bce16def13154271295/37523/URP_img004.png\"\n        srcset=\"/static/7715d9caabac0bce16def13154271295/e9ff0/URP_img004.png 180w,\n/static/7715d9caabac0bce16def13154271295/f21e7/URP_img004.png 360w,\n/static/7715d9caabac0bce16def13154271295/37523/URP_img004.png 720w,\n/static/7715d9caabac0bce16def13154271295/302a4/URP_img004.png 1080w,\n/static/7715d9caabac0bce16def13154271295/6d74e/URP_img004.png 1085w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</div>\n<ul>\n<li>DX11까지의 렌더링 파이프라인은 좌측과 같으나, 이걸 다 다루면 상당한 시간이 걸립니다.</li>\n<li>셰이더를 만들때는 오른쪽과 같은 느낌으로 간단하게 생각해주세요</li>\n<li>appdata 는 버텍스 인풋이라고도 불리고, v2f 는 버텍스 아웃풋이라고도 불립니다</li>\n<li>서피스 함수에서 Input이라고 불렸던 구조체는 버텍스 아웃풋과 동일한 구조체입니다</li>\n</ul>\n<p><strong>셰이더 명, 프로퍼티, 각종태그</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">Shader <span class=\"token string\">\"CustomLighting/Master\"</span>\n<span class=\"token punctuation\">{</span>\n\t\tProperties\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">_Color</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"Color\"</span><span class=\"token punctuation\">,</span> Color<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">_MainTex</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"BaseColor Texture\"</span><span class=\"token punctuation\">,</span> 2D<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"white\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\n\t\t<span class=\"token punctuation\">.</span>\n\t\t<span class=\"token punctuation\">.</span>\n\t\t<span class=\"token punctuation\">.</span>\n\n\t\tSubShader\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\tTags\n\t\t\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t<span class=\"token string\">\"RenderPipeline\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"UniversalPipeline\"</span>\n\t\t\t\t\t\t<span class=\"token string\">\"RenderType\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Opaque\"</span>\n\t\t\t\t\t\t<span class=\"token string\">\"Queue\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Geometry+0\"</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\tLOD <span class=\"token number\">100</span>\n\n\t\t\t\t<span class=\"token punctuation\">.</span>\n\t\t\t\t<span class=\"token punctuation\">.</span>\n\t\t\t\t<span class=\"token punctuation\">.</span>\n\t\t\t\n\t\t\t\tPass\n\t\t\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\t\t\tName <span class=\"token string\">\"Universal Forward\"</span>\n\t\t\t\t\t\tTags\n\t\t\t\t\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t\t\t<span class=\"token string\">\"LightMode\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"UniversalForward\"</span>\n\t\t\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\t\t\tCull Back\n\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<ul>\n<li>여기는 기존 Legacy 방식과 거의 비슷합니다</li>\n<li><code class=\"language-text\">[Header]</code>, <code class=\"language-text\">[Space()]</code>, <code class=\"language-text\">(Enum.UnityEngine.Rendering.BlendMode)</code>등 기존 어트리뷰트 동일하게 사용가능</li>\n<li>태그 렌더 파이프라인에 <code class=\"language-text\">UniversalPipeline</code>이라고 넣어주고, Pass 안에서는 LightMode를 정의해줍니다</li>\n<li>컬링, 블랜드모드, Zwrite, Ztest 등도 모두 여기에서 기존과 동일한 방식으로 입력 가능</li>\n<li>라이트 모드는 기존 ForwardBase에서 UniversalForward로 바뀌었습니다 (Forward Add는 이제 없습니다)</li>\n</ul>\n<p><strong>멀티 컴파일, 인클루드</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">HLSLPROGRAM\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">prefer_hlslcc gles</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">exclude_renderers d3d11_9x</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">vertex vert</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">fragment frag</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl\"</span></span>\n\n<span class=\"token comment\">// GPU Instancing</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile_instancing</span></span>\n\n<span class=\"token comment\">// Fog</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile_fog</span></span>\n\n<span class=\"token comment\">// Light &amp; Shadow</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ _MAIN_LIGHT_SHADOWS</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ _MAIN_LIGHT_SHADOWS_CASCADE</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ _ADDITIONAL_LIGHTS</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ _ADDITIONAL_LIGHT_SHADOWS</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ _SHADOWS_SOFT</span></span>\n\n<span class=\"token comment\">// lightmap</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ DIRLIGHTMAP_COMBINED</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ LIGHTMAP_ON</span></span></code></pre></div>\n<ul>\n<li>GPU Instancing은 SRP Batcher를 사용할 것이라면 빼도 무방합니다</li>\n<li>라이트를 하나만 사용할 거면 <code class=\"language-text\">_ADDITIONAL_LIGHTS</code> 키워드도 사용하지 않아도 됩니다.</li>\n<li>하드라이트만 사용할 거라면 <code class=\"language-text\">_SHADOWS_SOFT</code> 키워드를 빼도 됩니다</li>\n<li>라이트 맵을 사용할 거라면 <code class=\"language-text\">LIGHTMAP_ON</code> 키워드를 추가해주세요</li>\n<li><em>Lighting.hlsl</em> 은 완전 unlit을 할게 아니라면 거의 사용하게 될 주요 hlsl입니다.</li>\n</ul>\n<p><strong>CBUFFER, Vertex Input, Vertex Output</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token function\">CBUFFER_START</span> <span class=\"token punctuation\">(</span>UnityPerMaterial<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">TEXURE2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">SAMPLER</span><span class=\"token punctuation\">(</span>sampler_MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">float4</span> _MainTex_ST<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">half4</span> _Color<span class=\"token punctuation\">;</span>\n\nCBUFFER_END\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">appdata</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float4</span> vertex <span class=\"token operator\">:</span> POSITION<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float2</span> texcoord <span class=\"token operator\">:</span> TEXCOORD0<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float3</span> normal <span class=\"token operator\">:</span> NORMAL<span class=\"token punctuation\">;</span>\n\t\tUNITY_VERTEX_INPUT_INSTANCE_ID\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">v2f</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float4</span> vertex <span class=\"token operator\">:</span> SV_POSITION<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// vertex : 버텍스 포지션 (필수)</span>\n\t\t<span class=\"token keyword\">float3</span> normal <span class=\"token operator\">:</span> NORMAL<span class=\"token punctuation\">;</span>              <span class=\"token comment\">// normal : 라이팅 계산 해야하면 추가</span>\n\t\t<span class=\"token keyword\">float2</span> texcoord <span class=\"token operator\">:</span> TEXCOORD0<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// texcoord : 텍스쳐 넣을거면 추가</span>\n\t\t<span class=\"token keyword\">float</span> fogCoord <span class=\"token operator\">:</span> TEXCOORD1<span class=\"token punctuation\">;</span>          <span class=\"token comment\">// fogDoord : 포그 넣을거면 추가</span>\n\t\t<span class=\"token keyword\">float4</span> shadowCoord <span class=\"token operator\">:</span> TEXCOORD2<span class=\"token punctuation\">;</span>      <span class=\"token comment\">// shadowCoord : 실시간 그림자 맵 사용할거면 추가</span>\n\t\t<span class=\"token keyword\">float3</span> worldPos <span class=\"token operator\">:</span> TEXCOORD3<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// worldPos : 뭔가 월드에서 포지션 계산할 일이 있으면 추가</span>\n\t\tUNITY_VERTEX_INPUT_INSTANCE_ID       <span class=\"token comment\">// GPU 인스턴싱 할거면 추가</span>\n\t\tUNITY_VERTEX_OUTPUT_STEREO           <span class=\"token comment\">// VR에서 사용할 셰이더라면 추가</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>프로퍼티 변수들은 무조건 <em>CBUFFER</em> 로 감싸줍니다</li>\n<li>GPU 인스턴싱을 사용하지 않을 거면 <code class=\"language-text\">UNITY_VERTEX_INPUT_INSTANCE_ID</code>는 없어도 됩니다</li>\n<li>VR을 사용하지 않는다면 <code class=\"language-text\">UNITY_VERTEX_OUTPUT_STEREO</code>는 없어도 됩니다</li>\n<li>포그를 사용하지 않는다면 <code class=\"language-text\">fogCoord</code>가 없어도 되고</li>\n<li>그림자를 생성하지 않는다면 <code class=\"language-text\">shadowCoord</code>가 없어도 되고</li>\n<li>라이트를 여러 개 사용하지 않는다면 worldPos가 없어도 됩니다 (만 WorldPos는 다른데에 사용할일이 많긴 합니다)</li>\n<li>v2f라는 구조체 이름은 <em>vertex to fragment</em>라는 뜻 입니다</li>\n<li>이 값들에 대한 자세한 내용은 버텍스 셰이더를 보면 나옵니다.</li>\n<li>예전에는 <code class=\"language-text\">appdata_tan</code>, <code class=\"language-text\">appdata_full</code>등의 미리 지정된 구조체들이 있었지만, 이제는 잊으세요!</li>\n</ul>\n<p><strong>버텍스 셰이더</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">v2f <span class=\"token function\">vert</span> <span class=\"token punctuation\">(</span>appdata v<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\tv2f o<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">UNITY_SETUP_INSTANCE_ID</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">UNITY_TRANSFER_INSTANCE_ID</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">,</span> o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\to<span class=\"token punctuation\">.</span>vertex <span class=\"token operator\">=</span> <span class=\"token function\">TransformObjectToHClip</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// vertex : 버텍스 클립포지션은 무조건 필요합니다</span>\n\t\to<span class=\"token punctuation\">.</span>texcoord <span class=\"token operator\">=</span> <span class=\"token function\">TRANSFORM_TEX</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">,</span> _MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">// texcoord : texcoord는 일반적으로 uv라 부르는 텍스쳐 샘플링 좌표입니다. TRANSFORM_TEX 함수로 _MainTex_ST와 연결시켜줍니다. ST는 Scale Translate의 약자입니다</span>\n\t\to<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">=</span> <span class=\"token function\">TransformObjectToWorldNormal</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// normal : 오브젝트 노멀을 월드노멀로 변환해줍니다. 라이팅연산을 안할거면 해당 코드를 지워도 됩니다</span>\n\t\to<span class=\"token punctuation\">.</span>fogCoord <span class=\"token operator\">=</span> <span class=\"token function\">ComputeFogFactor</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">// fogCoord : 클립포지션의 z값을 기반으로 어느정도 포그가 적용되어야 할지에 대한 값을 구합니다</span>\n\t\to<span class=\"token punctuation\">.</span>worldPos <span class=\"token operator\">=</span> <span class=\"token function\">TransformObjectToWorld</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// worldPos : 뭔가 월드에서 계산할일이 있으면 추가 (라이트 계산등은 주로 월드에서 합니다)</span>\n\t\to<span class=\"token punctuation\">.</span>shadowCoord <span class=\"token operator\">=</span> <span class=\"token function\">TrnasformWorldToShadowCoord</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>worldPos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// shadowCoord : 그림자 맵의 좌표를 구합니다</span>\n\n\t\t<span class=\"token keyword\">return</span> o<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>각 버텍스 아웃풋 데이터들이 거의 하나의 함수로 간단하게 계산되고 있는 것을 볼 수 있습니다</li>\n</ul>\n<p><strong>공간변환</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\">o<span class=\"token punctuation\">.</span>vertex <span class=\"token operator\">=</span> <span class=\"token function\">TransformObjectToHClip</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\no<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">=</span> <span class=\"token function\">TransformObjectToWorldNormal</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\no<span class=\"token punctuation\">.</span>worldPos <span class=\"token operator\">=</span> <span class=\"token function\">TransformObjectToWorld</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// SpaceTransforms.hlsl</span>\n<span class=\"token keyword\">float4</span> <span class=\"token function\">TransformWorldToHClip</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float3</span> positionWS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">mul</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetWorldToHClipMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">float4</span><span class=\"token punctuation\">(</span>positionWS<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">float3</span> <span class=\"token function\">TransformObjectToWorldNormal</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float3</span> normalOS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">UNITY_ASSUME_UNIFORM_SCALING</span></span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">TransformObjectToWorldDir</span><span class=\"token punctuation\">(</span>normalOS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t\t<span class=\"token comment\">// Normal need to be multiply by inverse transpose</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">SafeNormalize</span><span class=\"token punctuation\">(</span><span class=\"token function\">mul</span><span class=\"token punctuation\">(</span>normalOS<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float3x3</span><span class=\"token punctuation\">)</span><span class=\"token function\">GetWorldToObjectMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">float3</span> <span class=\"token function\">TransformObjectToWorld</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float3</span> positionOS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">mul</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetObjectToWorldMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">float4</span><span class=\"token punctuation\">(</span>positionOS<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><em>SpaceTransforms.hlsl</em> 을 열어봅시다</li>\n<li>유니티는 행렬과 벡터를 연산할 때 행렬 * 벡터 순으로 계산해야합니다</li>\n<li>다만 노멀의 경우 월드로 갈 때 Inverse Transpose (전치역행렬)을 곱해주어야 틀어지지 않은 제대로된 노멀값을 얻을 수 있으므로 순서를 바꿔줍니다</li>\n<li>회전행렬의 경우 곱하는 순서를 바꾸면 역행렬 계산을 할 수 있기 때문에 이것을 알아두면 공간변활할 때 굉장히 유용합니다</li>\n<li>행렬을 구하는 코드들을 보면 <code class=\"language-text\">UNITY_MATRIX_M</code> ← 이렇게 예전방식 행렬들을 그대로 사용하고 있는 것을 알 수 있습니다</li>\n</ul>\n<p><strong>텍스쳐 좌표</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// vert()</span>\no<span class=\"token punctuation\">.</span>texcoord <span class=\"token operator\">=</span> <span class=\"token function\">TRANSFORM_TEX</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">,</span> _MainTex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\no<span class=\"token punctuation\">.</span>texcoord <span class=\"token operator\">=</span> v<span class=\"token punctuation\">.</span>texcoord <span class=\"token operator\">*</span> _MainTex_ST<span class=\"token punctuation\">.</span>xy <span class=\"token operator\">+</span> _MainTex_ST<span class=\"token punctuation\">.</span>zw<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 윗줄 코드와 같다</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">TRANSFORM_TEX</code>는 사실 <code class=\"language-text\">_MainTEX_ST</code>라는 변수의 xy값을 곱해서 스케일로 사용하고, zw를 더해서 옵셋으로 사용한 것을 간편한 함수로 표현한 것입니다</li>\n<li>여전히 레거시 방식 그대로 사용이 가능합니다</li>\n</ul>\n<p><strong>포그 좌표</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// frag()</span>\no<span class=\"token punctuation\">.</span>fogCoord <span class=\"token operator\">=</span> <span class=\"token function\">ComputeFogFactor</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Core.hlsl</span>\nreal <span class=\"token function\">ComputeFogFactor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> z<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float</span> clupZ_01 <span class=\"token operator\">=</span> <span class=\"token function\">UNITY_Z_0_FAR_FROM_CLIPSAPCE</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>FOG_LINEAR<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token comment\">// factor = (end-z)/(end-start) = z * (-1/(end-start)) + (end/(end-start))</span>\n\t\t<span class=\"token keyword\">float</span> fogFactor <span class=\"token operator\">=</span> <span class=\"token function\">saturate</span><span class=\"token punctuation\">(</span>clipZ_01 <span class=\"token operator\">*</span> unity_FogParams<span class=\"token punctuation\">.</span>z <span class=\"token operator\">+</span> unity_FogParams<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">real</span><span class=\"token punctuation\">(</span>fogFactor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">elif</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>FOG_EXP<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>FOG_EXP2<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token comment\">// factor = exp(-(density*z)*2)</span>\n\t\t<span class=\"token comment\">// -density * z computed at vertex</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">real</span><span class=\"token punctuation\">(</span>unity_FogParams<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> clipZ_01<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0.</span>0b<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><em>Core.hlsl</em> 파일을 열어보면 포그좌표 구하는 공식을 볼 수 있습니다</li>\n<li>Linear, Exponential, Exponential Squared 방식에 따라 각각 계산방법이 정의되어 있습니다</li>\n<li>포그는 좌표만 구하면 픽셀 셰이더에서는 보간만 해주는 방식</li>\n<li>포그는 셰이더 그래프에 포그 노드가 있지만 Unlit Master에서는 <code class=\"language-text\">multi_compile_fog</code>가 없어서 작동하지 않습니다</li>\n<li>(PBR Master는 <code class=\"language-text\">multi_compile_fog</code> 키워드도 있고 Mixfog 계산도 다 되어있어서 포그노드 없이도 알아서 잘 작동)</li>\n</ul>\n<p><strong>그림자 좌표</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// frag()</span>\nVertexPositionInputs vertexInput <span class=\"token operator\">=</span> <span class=\"token function\">GetVertexPositionInputs</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>vertex<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\no<span class=\"token punctuation\">.</span>shadowCoord <span class=\"token operator\">=</span> <span class=\"token function\">GetShadowCoord</span><span class=\"token punctuation\">(</span>vertexInput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\no<span class=\"token punctuation\">.</span>shadowCoord <span class=\"token operator\">=</span> <span class=\"token function\">TransformWorldToShadowCoord</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>worldPos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Core.hlsl</span>\nVertexPositionInputs <span class=\"token function\">GetVertexPositionInputs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float3</span> positionOS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\tVertexPositionInputs Input<span class=\"token punctuation\">;</span>\n\t\tInput<span class=\"token punctuation\">.</span>positionWS <span class=\"token operator\">=</span> <span class=\"token function\">TransformOjbectToWorld</span><span class=\"token punctuation\">(</span>positionOS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tInput<span class=\"token punctuation\">.</span>positionVS <span class=\"token operator\">=</span> <span class=\"token function\">TransformWorldToView</span><span class=\"token punctuation\">(</span>Input<span class=\"token punctuation\">.</span>positionWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tInput<span class=\"token punctuation\">.</span>positionCS <span class=\"token operator\">=</span> <span class=\"token function\">TransformWorldToHClip</span><span class=\"token punctuation\">(</span>Input<span class=\"token punctuation\">.</span>positionWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">float4</span> ndc <span class=\"token operator\">=</span> Input<span class=\"token punctuation\">.</span>positionCS <span class=\"token operator\">*</span> <span class=\"token number\">0.5f</span><span class=\"token punctuation\">;</span>\n\t\tInput<span class=\"token punctuation\">.</span>positionNDC<span class=\"token punctuation\">.</span>xy <span class=\"token operator\">=</span> <span class=\"token keyword\">float2</span><span class=\"token punctuation\">(</span>ndc<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> ndc<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> _ProjectionParams<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> ndc<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">;</span>\n\t\tInput<span class=\"token punctuation\">.</span>positionNDC<span class=\"token punctuation\">.</span>zw <span class=\"token operator\">=</span> Input<span class=\"token punctuation\">.</span>positionCS<span class=\"token punctuation\">.</span>zw<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> Input<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Shadows.hlsl</span>\n<span class=\"token keyword\">float4</span> <span class=\"token function\">GetShadowCoord</span><span class=\"token punctuation\">(</span>VertexPositionInputs vertexInput<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">SHADOWS_SCREEN</span></span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">ComputeScreenPos</span><span class=\"token punctuation\">(</span>vertexInput<span class=\"token punctuation\">.</span>positionCS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">TransformWorldToShadowCoord</span><span class=\"token punctuation\">(</span>vertexInput<span class=\"token punctuation\">.</span>positionWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">float4</span> <span class=\"token function\">TransformWorldToShadowCoord</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float3</span> positionWS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">_MAIN_LIGHT_SHADOWS_CASCADE</span></span>\n\t\t<span class=\"token keyword\">half</span> cascadeIndex <span class=\"token operator\">=</span> <span class=\"token function\">ComputeCascadeIndex</span><span class=\"token punctuation\">(</span>positionWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">mul</span><span class=\"token punctuation\">(</span>_MainLightWorldToShadow<span class=\"token punctuation\">[</span>cascadeIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">float4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">mul</span><span class=\"token punctuation\">(</span>_MainLightWorldToShadow<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">float4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><em>Core.hlsl</em> 과 <em>Shadows.hlsl</em>을 보면 해당 코드가 있습니다</li>\n<li><code class=\"language-text\">ShadowCoord</code>를 구할 때 <code class=\"language-text\">VertexInput</code>을 넣어주는건 결국 <code class=\"language-text\">worldPosition</code>을 구하기 위함입니다</li>\n<li>각 공간의 포지션 값을 굳이 다 계산할 것 없이, <code class=\"language-text\">GetShadowCoord()</code>를 쓰지말고, 바로 <code class=\"language-text\">TransformWorldToShadowCoord()</code>를 사용하는 것도 좋은 방법입니다</li>\n</ul>\n<p><strong>프레그먼트 셰이더 / Fragment Shader</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token keyword\">half4</span> <span class=\"token function\">frag</span> <span class=\"token punctuation\">(</span>v2f i<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> SV_Target\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">UNITY_SETUP_INSTANCE_ID</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Get MainLight</span>\n\t\tLight mainLight <span class=\"token operator\">=</span> <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>shadowCoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ti<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Diffuse</span>\n\t\t<span class=\"token keyword\">float3</span> lambert <span class=\"token operator\">=</span> <span class=\"token function\">LightingLambert</span><span class=\"token punctuation\">(</span>mainLight<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> mainLight<span class=\"token punctuation\">.</span>direction<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float4</span> c <span class=\"token operator\">=</span> <span class=\"token function\">SAMPLE_TEXTURE2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> sampler_MainTex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _Color<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Specular</span>\n\t\t<span class=\"token keyword\">float3</span> specular <span class=\"token operator\">=</span> <span class=\"token function\">LightingSpecular</span><span class=\"token punctuation\">(</span>mainLight<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> mainLight<span class=\"token punctuation\">.</span>direction<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>viewDir<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> _Gloss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// GI</span>\n\t\t<span class=\"token keyword\">half3</span> ambient <span class=\"token operator\">=</span> <span class=\"token function\">SampleSH</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Combine</span>\n\t\tc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*=</span> lambert <span class=\"token operator\">*</span> mainLight<span class=\"token punctuation\">.</span>distanceAttenuation <span class=\"token operator\">*</span> mainLight<span class=\"token punctuation\">.</span>shadowAttenuation<span class=\"token punctuation\">;</span>\n\t\tc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">+=</span> ambient <span class=\"token operator\">+</span> specular<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Get Additional Light</span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifedf</span> <span class=\"token expression\">_ADDITIONAL_LIGHTS</span></span>\n\t\t\t\t<span class=\"token keyword\">uint</span> pixelLightCount <span class=\"token operator\">=</span> <span class=\"token function\">GetAdditionalLightsCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">uint</span> lightIndex <span class=\"token operator\">=</span> <span class=\"token number\">0u</span><span class=\"token punctuation\">;</span> lightIndex <span class=\"token operator\">&lt;</span> pixelLightCount<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>lightIndex<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\t\t\tLight addLight <span class=\"token operator\">=</span> <span class=\"token function\">GetAdditionalLight</span><span class=\"token punctuation\">(</span>lightIndex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>worldPos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t<span class=\"token keyword\">float3</span> addLightResult <span class=\"token operator\">=</span> <span class=\"token function\">LightingLambert</span><span class=\"token punctuation\">(</span>addLight<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> addLight<span class=\"token punctuation\">.</span>direction<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> addLight<span class=\"token punctuation\">.</span>distanceAttenuation<span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t<span class=\"token keyword\">float3</span> addLightSpecular <span class=\"token operator\">=</span> <span class=\"token function\">LightingSpecular</span><span class=\"token punctuation\">(</span>addLight<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> addLight<span class=\"token punctuation\">.</span>direction<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>viewDir<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> _Gloss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\tc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">+=</span> addLightResult <span class=\"token operator\">+</span> addLightSpecular<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n\t\t<span class=\"token comment\">// Fog</span>\n\t\tc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">=</span> <span class=\"token function\">MixFog</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>rgb<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>fogCoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t\t<span class=\"token keyword\">return</span> c<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>라이트 구조체 / Light struct</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// frag()</span>\nLight mainLight <span class=\"token operator\">=</span> <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>shadowCoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Lighting.hlsl</span>\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Light</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">half3</span> direction<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half3</span> color<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span>  distanceAttenuation<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span>  shadowAttenuation<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Lighting.hlsl</span>\nLight <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\tLight light<span class=\"token punctuation\">;</span>\n\t\tlight<span class=\"token punctuation\">.</span>direction <span class=\"token operator\">=</span> _MainLightPosition<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">// unity_LightData.z is 1 when not culled by the culling mask, otherwise 0.</span>\n\t\tlight<span class=\"token punctuation\">.</span>distanceAttenuation <span class=\"token operator\">=</span> unity_LightData<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>LIGHTMAP_ON<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>_MIXED_LIGHTING_SUBTRACTIVE<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token comment\">// unity_ProbesOcclusion.x is the mixed light probe occlusion data</span>\n\t\tlight<span class=\"token punctuation\">.</span>distanceAttenuation <span class=\"token operator\">*=</span> unity_ProbesOcclusion<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\t\tlight<span class=\"token punctuation\">.</span>shadowAttenuation <span class=\"token operator\">*=</span> unity_ProbesOcclusion<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n\t\tlight<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> _MainLightColor<span class=\"token punctuation\">.</span>rgb<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> light<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nLight <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float4</span> shadowCoord<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\tLight light <span class=\"token operator\">=</span> <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tlight<span class=\"token punctuation\">.</span>shadowAttenuation <span class=\"token operator\">=</span> <span class=\"token function\">MainLightRealtimeShadow</span><span class=\"token punctuation\">(</span>shadowCoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> light<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><em>Lighting.hlsl</em>에서 해당 내용을 확인할 수 있습니다</li>\n<li><code class=\"language-text\">GetMainLight</code>의 인자를 비워두느냐 <code class=\"language-text\">shadowCoord</code>를 넣어주느냐에 따라 <code class=\"language-text\">Attenuation</code>값이 달라집니다</li>\n<li>굳이 구조체로 안해도 <code class=\"language-text\">_MainLightPosition.xyz</code>라는 값으로 메인라이트의 포지션을 가져올 수 있긴 합니다</li>\n<li>하지만 Light 구조체를 이용해야 <code class=\"language-text\">Attenuation</code>값들을 이용할 수 있으니 습관을 들이도록 합시다</li>\n</ul>\n<p><strong>감쇠 / Attenuation</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// Lighting.hlsl</span>\nflaot3 lightVector <span class=\"token operator\">=</span> lightPositionWS<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">-</span> positionWS <span class=\"token operator\">*</span> lightPositionWS<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">float</span> distanceSqr <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>lightVector<span class=\"token punctuation\">,</span> lightVector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> HALF_MIN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">half3</span> lightDirection <span class=\"token operator\">=</span> <span class=\"token keyword\">half3</span><span class=\"token punctuation\">(</span>lightVector <span class=\"token operator\">*</span> <span class=\"token function\">rsqrt</span><span class=\"token punctuation\">(</span>distanceSqr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">half</span> attenuation <span class=\"token operator\">=</span> <span class=\"token function\">DistanceAttenuation</span><span class=\"token punctuation\">(</span>distanceSqr<span class=\"token punctuation\">,</span> distanceAndSpotAttenuation<span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">AngleAttenuation</span><span class=\"token punctuation\">(</span>spotDirection<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">,</span> lightDirection<span class=\"token punctuation\">,</span> distanceAndSpotAttenuation<span class=\"token punctuation\">.</span>zw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nLight light<span class=\"token punctuation\">;</span>\nlight<span class=\"token punctuation\">.</span>direction <span class=\"token operator\">=</span> lightDirection<span class=\"token punctuation\">;</span>\nlight<span class=\"token punctuation\">.</span>distanceAttenuation <span class=\"token operator\">=</span> attenuation<span class=\"token punctuation\">;</span>\nlight<span class=\"token punctuation\">.</span>shadowAttenuation <span class=\"token operator\">=</span> <span class=\"token function\">AdditionalLightRealtimeShadow</span><span class=\"token punctuation\">(</span>perObjectLightInedx<span class=\"token punctuation\">,</span> positionWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nlight<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> color<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">distanceAttenuation</code>은 광원과 표면의 ‘거리’에 대한 감쇠와 스팟라이트일 때 스팟라이트의 ‘범위각(AngleAttenuation)’에 zw. 이렇게 두가지의 값이 곱해진 값입니다. 즉 Directional Light일 경우에는 감쇠가 되지 않으므로 항상 1인 값입니다. (첫줄에서 <code class=\"language-text\">lightPositionWS.w</code>를 곱해주어 이것을 판별합니다. 디렉셔널 라이트는 이 값이 0이 되어, <code class=\"language-text\">lightPositionWS</code>만으로 벡터를 구할 수 있습니다.</li>\n<li><code class=\"language-text\">shadowAttenuation</code>은 실시간 그림자가 드리워져서 어두워지는 것을 의미합니다 (리얼타임 섀도우)</li>\n</ul>\n<p><strong>실시간 그림자 / Realtime Shadow</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// Lighting.hlsl</span>\nLight <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float4</span> shadowCoord<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\tLight light <span class=\"token operator\">=</span> <span class=\"token function\">GetMainLight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tlight<span class=\"token punctuation\">.</span>shadowAttenuation <span class=\"token operator\">=</span> <span class=\"token function\">MainLightRealtimeShadow</span><span class=\"token punctuation\">(</span>shadowCoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> light<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">multi_compile _ _SHADOWS_SOFT</span></span>\n\n<span class=\"token comment\">// Shadows.hlsl</span>\n<span class=\"token keyword\">half</span> <span class=\"token function\">MainLightRealtimeShadow</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float4</span> shadowCoord<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token operator\">!</span><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>_MAIN_LIGHT_SHADOWS<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>_RECEIVE_SHADOWS_OFF<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">1.0h</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">SHADOWS_SCREEN</span></span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">SamplesScreenSpaceShadowmap</span><span class=\"token punctuation\">(</span>shadowCoord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t\tShadowSamplingData shadowSamplingData <span class=\"token operator\">=</span> <span class=\"token function\">GetMainLightShadowSamplingData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half4</span> shadowParams <span class=\"token operator\">=</span> <span class=\"token function\">GetMainLightShadowParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">SampleShadowmap</span><span class=\"token punctuation\">(</span><span class=\"token function\">TEXUTRE2D_ARGS</span><span class=\"token punctuation\">(</span>_MainLightShadowmapTexture<span class=\"token punctuation\">,</span> sampler_MainLightShadowmapTexture<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">,</span> shadowSamplingData<span class=\"token punctuation\">,</span> shadowParams<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n<span class=\"token punctuation\">}</span>\n\nreal <span class=\"token function\">SampleShadowmap</span><span class=\"token punctuation\">(</span><span class=\"token function\">TEXTURE2D_SHADOW_PARAM</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> smapler_ShadowMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">float4</span> shadowCoord<span class=\"token punctuation\">,</span> ShadowSamplingData samplingData<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half4</span> shadowParams<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span> isPerspectiveProjection <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// Compiler will optimize this branch away as long as isPerspectiveProjection is known at compile time</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isPerspectiveProjection<span class=\"token punctuation\">)</span>\n\t\t\t\tshadowCoord<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">/=</span> shadowCoord<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">;</span>\n\n\t\treal attenuation<span class=\"token punctuation\">;</span>\n\t\treal shadowStrength <span class=\"token operator\">=</span> shadowParams<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// TODO : We could branch on if this light has soft shadow (shadowParams/y) to save perf on some platforms.</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">_SHADOW_SOFT</span></span>\n\t\tattenuation <span class=\"token operator\">=</span> <span class=\"token function\">SampleShadowmapFiltered</span><span class=\"token punctuation\">(</span><span class=\"token function\">TEXTURE2D_SHADOW_ARGS</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">,</span> samplingData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t\t<span class=\"token comment\">// 1-tap hardware comparison</span>\n\t\tattenuation <span class=\"token operator\">=</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n\t\tattenuation <span class=\"token operator\">=</span> <span class=\"token function\">LerpWhiteTo</span><span class=\"token punctuation\">(</span>attenuation<span class=\"token punctuation\">,</span> shadowStrength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Shadow coords that fall out of the light frustum volume must always return attenuation 1.0</span>\n\t\t<span class=\"token comment\">// TODO : We could use branch here to save som perf on som platforms.</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">BEYOND_SHADOW_FAR</span><span class=\"token punctuation\">(</span>shadowCoord<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">1.0</span> <span class=\"token operator\">:</span> attenuation<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nreal <span class=\"token function\">SampleShadowmapFiltered</span><span class=\"token punctuation\">(</span><span class=\"token function\">TEXTURE2D_SHADOW_PARAM</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">float4</span> shadowCoord<span class=\"token punctuation\">,</span> ShadowSamplingData samplingData<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    real attenuation<span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>SHADER_API_MOBILE<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>SHADER_API_SWITCH<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token comment\">// 4-tap hardware comparison</span>\n\t\treal4 attenuation4<span class=\"token punctuation\">;</span>\n\t\tattenuation4<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">+</span> samplingData<span class=\"token punctuation\">.</span>ShadowOffset0<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation4<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">+</span> samplingData<span class=\"token punctuation\">.</span>ShadowOffset1<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation4<span class=\"token punctuation\">.</span>z <span class=\"token operator\">=</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">+</span> samplingData<span class=\"token punctuation\">.</span>ShadowOffset2<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation4<span class=\"token punctuation\">.</span>w <span class=\"token operator\">=</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">+</span> samplingData<span class=\"token punctuation\">.</span>ShadowOffset3<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>attenuation4<span class=\"token punctuation\">,</span> <span class=\"token number\">0.25</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n\t\t<span class=\"token keyword\">float</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">float2</span> fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">SampleShadow_ComputeSamples_Tent_5x5</span><span class=\"token punctuation\">(</span>samplingData<span class=\"token punctuation\">.</span>shadowmapSize<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> fetchesWeights<span class=\"token punctuation\">,</span> fetchesUV<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\tattenuation <span class=\"token operator\">=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattenuation <span class=\"token operator\">+=</span> fetchesWeights<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token function\">SAMPLE_TEXTURE2D_SHADOW</span><span class=\"token punctuation\">(</span>ShadowMap<span class=\"token punctuation\">,</span> sampler_ShadowMap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>fetchesUV<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xy<span class=\"token punctuation\">,</span> shadowCoord<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n    <span class=\"token keyword\">return</span> attenuation<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">GetMainLight</code>의 인자에 <code class=\"language-text\">ShadowCoord</code>를 넣으면 <code class=\"language-text\">MainLightRealtimeShadow()</code>계산</li>\n<li><code class=\"language-text\">SampleShadowMap()</code>안에서 <code class=\"language-text\">_SHADOWS_SOFT</code> 키워드가 들어오면 <code class=\"language-text\">SampleShadowmapFiltered()</code> 함수를 실행</li>\n<li>셰이더 그래프에서는 글로벌 키워드 작성이 불가능하므로 커스텀 노드에서 <code class=\"language-text\">SampleShadowmapFiltered()</code> 함수를 직접 실행히야합니다</li>\n</ul>\n<p><strong>램버트 라이트 모델 (디퓨즈) / LightingLambert</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// frag()</span>\n\n<span class=\"token comment\">// Diffuse</span>\n<span class=\"token keyword\">float3</span> lambert <span class=\"token operator\">=</span> <span class=\"token function\">LightingLambert</span><span class=\"token punctuation\">(</span>mainLight<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> mainLight<span class=\"token punctuation\">.</span>direction<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">float4</span> c <span class=\"token operator\">=</span> <span class=\"token function\">SAMPLE_TEXTURE2D</span><span class=\"token punctuation\">(</span>_MainTex<span class=\"token punctuation\">,</span> smapler_MainTex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>texcoord<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> _Color<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Lighting.hlsl</span>\n<span class=\"token keyword\">half3</span> <span class=\"token function\">LightingLambert</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span> lightColor<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> lightDir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> normal<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">half</span> NdotL <span class=\"token operator\">=</span> <span class=\"token function\">saturate</span><span class=\"token punctuation\">(</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>normal<span class=\"token punctuation\">,</span> lightDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> lightColor <span class=\"token operator\">*</span> NdotL<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>램버트는 라이트벡터와 노멀의 내적연산으로 간단하게 구할 수 있지만 코드정리를 위해 <em>Lighting.hlsl</em>의 <code class=\"language-text\">LightingLambert</code>함수를 써 주었습니다 (굳이 쓰지 않아도 됩니다)</li>\n<li>NPR이나 Stylized 한 표현을 하고싶다면 <code class=\"language-text\">LightingLambert</code>함수를 쓰지말고, 내적만 한 NdotL 값에 <code class=\"language-text\">* 0.5 + 0.5</code> 를 한 후 <code class=\"language-text\">SmoothStep</code>을 사용하면 됩니다 (컬러는 그 후에 곱하면 됩니다)</li>\n</ul>\n<p><strong>GI</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// frag()</span>\n<span class=\"token keyword\">half3</span> ambient <span class=\"token operator\">=</span> <span class=\"token function\">SampleSH</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Lighting.hlsl</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">LIGHTMAP_ON</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name function\">SMAPLE_GI</span><span class=\"token expression\"><span class=\"token punctuation\">(</span>lmName<span class=\"token punctuation\">,</span> shName<span class=\"token punctuation\">,</span> normalWSName<span class=\"token punctuation\">)</span> <span class=\"token function\">SampleLightmap</span><span class=\"token punctuation\">(</span>lmName<span class=\"token punctuation\">,</span> normalWSName<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name function\">SMAPLE_GI</span><span class=\"token expression\"><span class=\"token punctuation\">(</span>lmName<span class=\"token punctuation\">,</span> shName<span class=\"token punctuation\">,</span> normalWSName<span class=\"token punctuation\">)</span> <span class=\"token function\">SampleSHPixel</span><span class=\"token punctuation\">(</span>shName<span class=\"token punctuation\">,</span> normalWSName<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n<span class=\"token keyword\">half3</span> indirectDiffuse <span class=\"token operator\">=</span> bakedGI <span class=\"token operator\">*</span> occlusion<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">half3</span> indirectSpecular <span class=\"token operator\">=</span> <span class=\"token function\">GlossyEnvironmentReflection</span><span class=\"token punctuation\">(</span>reflectVector<span class=\"token punctuation\">,</span> brdfData<span class=\"token punctuation\">.</span>perceptualRoughness<span class=\"token punctuation\">,</span> occlusion<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">half3</span> <span class=\"token function\">SampleSHVertex</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span> normalWS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>EVALUATE_SH_VERTEX<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">SampleSH</span><span class=\"token punctuation\">(</span>normalWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">elif</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>EVALUATE_SH_MIXED<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token comment\">// no max since this is only L2 contribution</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">SHEvlaLinearL2</span><span class=\"token punctuation\">(</span>normalWS<span class=\"token punctuation\">,</span> unity_SHBr<span class=\"token punctuation\">,</span> unity_SHBg<span class=\"token punctuation\">,</span> unity_SHBb<span class=\"token punctuation\">,</span> unity_SHC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n\t\t<span class=\"token comment\">// fully per-pixel. Nothing to compute</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">half3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">half3</span> <span class=\"token function\">SampleSHPixel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span> L2Term<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> normalWS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>EVALUATE_SH_VERTEX<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token keyword\">return</span> L2Term<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">elif</span> <span class=\"token expression\"><span class=\"token function\">defiend</span><span class=\"token punctuation\">(</span>EVALUATE_SH_MIXED<span class=\"token punctuation\">)</span></span></span>\n\t\t<span class=\"token keyword\">half3</span> L0L1Term <span class=\"token operator\">=</span> <span class=\"token function\">SHEvalLinearL0L1</span><span class=\"token punctuation\">(</span>normalWS<span class=\"token punctuation\">,</span> unity_SHAr<span class=\"token punctuation\">,</span> unity_SHAg<span class=\"token punctuation\">,</span> unity_SHAb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> L2Term <span class=\"token operator\">+</span> L0L1Term<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n\t\t<span class=\"token comment\">// Default : Evaluate SH fully per-pixel</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">SampleSH</span><span class=\"token punctuation\">(</span>normalWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>GI는 <code class=\"language-text\">indirectDiffuse</code>와 <code class=\"language-text\">indirectSpecular</code>가 있습니다</li>\n<li><code class=\"language-text\">indirectDiffuse</code>는 라이트맵이 있을때는 라이트맵으로 계산하고 라이트맵이 없을때는 <code class=\"language-text\">VertexSH + PixelSH</code>로 계산합니다</li>\n<li>SH는 <code class=\"language-text\">SampleSH</code>함수로 간단하게 <code class=\"language-text\">VertexSH + PiexlSH</code>를 한 번에 계산 가능합니다</li>\n<li><code class=\"language-text\">indirectSpecular</code>는 큐브맵으로 계산합니다. <code class=\"language-text\">GlossyEnvironmentReflection</code> 함수를 추가해주세요</li>\n<li>즉, BRDF 데이터를 사용하지 않을때에는 <code class=\"language-text\">indirectDiffuse</code>만 쓴다 정도로 정리하면 될 것 같습니다</li>\n</ul>\n<p><strong>구면조화 / SH</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// Lighting.hlsl</span>\n<span class=\"token keyword\">half3</span> <span class=\"token function\">SampleSH</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span> normalWS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">//LPPV is not supported in Lightweight Pipeline</span>\n\t\treal4 SHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\tSHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> unity_SHAr<span class=\"token punctuation\">;</span>\n\t\tSHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> unity_SHAg<span class=\"token punctuation\">;</span>\n\t\tSHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> unity_SHAb<span class=\"token punctuation\">;</span>\n\t\tSHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> unity_SHBr<span class=\"token punctuation\">;</span>\n\t\tSHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> unity_SHBg<span class=\"token punctuation\">;</span>\n\t\tSHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> unity_SHBb<span class=\"token punctuation\">;</span>\n\t\tSHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> unity_SHC<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">SampleSH9</span><span class=\"token punctuation\">(</span>SHCoefficients<span class=\"token punctuation\">,</span> normalWS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">float3</span> <span class=\"token function\">SmapleSH9</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float4</span> SHCoefficients<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">float3</span> N<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float3</span> res <span class=\"token operator\">=</span> <span class=\"token function\">SHEvalLinearL0L1</span><span class=\"token punctuation\">(</span>N<span class=\"token punctuation\">,</span> shAr<span class=\"token punctuation\">,</span> shAg<span class=\"token punctuation\">,</span> shAb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Linear + constant polynomial terms</span>\n\t\tres <span class=\"token operator\">+=</span> <span class=\"token function\">SHEvalLinearL2</span><span class=\"token punctuation\">(</span>N<span class=\"token punctuation\">,</span> shBr<span class=\"token punctuation\">,</span> shBg<span class=\"token punctuation\">,</span> shBb<span class=\"token punctuation\">,</span> shCr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// Quadratic polynomials</span>\n\t\t<span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// EntityLighting.hlsl</span>\nreal3 <span class=\"token function\">SHEvalLinearL0L1</span><span class=\"token punctuation\">(</span>real3 N<span class=\"token punctuation\">,</span> real4 shAr<span class=\"token punctuation\">,</span> real4 shAg<span class=\"token punctuation\">,</span> real4 shAb<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\treal4 vA <span class=\"token operator\">=</span> <span class=\"token function\">real4</span><span class=\"token punctuation\">(</span>N<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\treal3 x1<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">// Linear (L1) + constant (L0) polynomial terms</span>\n\t\tx1<span class=\"token punctuation\">.</span>r <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>shAr<span class=\"token punctuation\">,</span> vA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tx1<span class=\"token punctuation\">.</span>g <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>shAg<span class=\"token punctuation\">,</span> vA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tx1<span class=\"token punctuation\">.</span>b <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>shAb<span class=\"token punctuation\">,</span> vA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token keyword\">return</span> x1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nreal3 <span class=\"token function\">SHEvalLinearL2</span><span class=\"token punctuation\">(</span>real3 N<span class=\"token punctuation\">,</span> real4 shBr<span class=\"token punctuation\">,</span> real4 shBg<span class=\"token punctuation\">,</span> real4 shBb<span class=\"token punctuation\">,</span> real4 shC<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\treal3 x2<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">// 4 of the quadratic (L2) polynomials</span>\n\t\treal4 vB <span class=\"token operator\">=</span> N<span class=\"token punctuation\">.</span>xyzz <span class=\"token operator\">*</span> N<span class=\"token punctuation\">.</span>yzzx<span class=\"token punctuation\">;</span>\n\t\tx2<span class=\"token punctuation\">.</span>r <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>shBr<span class=\"token punctuation\">,</span> vB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tx2<span class=\"token punctuation\">.</span>g <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>shBg<span class=\"token punctuation\">,</span> vB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tx2<span class=\"token punctuation\">.</span>b <span class=\"token operator\">=</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>shBb<span class=\"token punctuation\">,</span> vB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Final (5th) quadratic (L2) polynomial</span>\n\t\treal vC <span class=\"token operator\">=</span> N<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> N<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> N<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> N<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n\t\treal3 x3 <span class=\"token operator\">=</span> shC<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> vC<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> x2 <span class=\"token operator\">+</span> x3<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> </code></pre></div>\n<ul>\n<li>SH는 Spherical Harmonics의 줄임</li>\n<li>간단하게 표현하면 노멀방향의 radiance정보들을 주기함수(<code class=\"language-text\">sin</code>, <code class=\"language-text\">cos</code>)를 이용하여 다양한 길이의 파장 조합 형태로 미리 계산하고 사용하는 것입니다. (Furier Transform)</li>\n<li>구면조화 함수에는 계수라고해서 파장 형태를 다양하게 나타내는 수치가 있는데 유니티에서는 9를 사용 (3단계)</li>\n<li>계수가 높아질수록 더 디테일한 값을 구할 수 있겠지만 적당히 근사치로 표현하는 편</li>\n<li><code class=\"language-text\">VertexSH</code>는 <code class=\"language-text\">SHEvalLinearL2</code>를, <code class=\"language-text\">PixelSH</code>는 <code class=\"language-text\">SHEvalLinearL0L1</code>함수를 각각 실행합니다.</li>\n</ul>\n<p><strong>추가 라이트 / Additional Light</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// frag()</span>\n<span class=\"token comment\">// Get Additional Light</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">_ADDITIONAL_LIGHTS</span></span>\n\t\t<span class=\"token keyword\">uint</span> <span class=\"token punctuation\">[</span>ixelLightCount <span class=\"token operator\">=</span> <span class=\"token function\">GetAdditionalLightsCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">uint</span> lightIndex <span class=\"token operator\">=</span> <span class=\"token number\">0u</span><span class=\"token punctuation\">;</span> lightIndex <span class=\"token operator\">&lt;</span> pixelLightCount<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>lightIndex<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\tLight addLight <span class=\"token operator\">=</span> <span class=\"token function\">GetAdditionalLight</span><span class=\"token punctuation\">(</span>lightIndex<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>worldPos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">float3</span> addLightResult <span class=\"token operator\">=</span> <span class=\"token function\">LightingLambert</span><span class=\"token punctuation\">(</span>addLight<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> addLight<span class=\"token punctuation\">.</span>direction<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> addLight<span class=\"token punctuation\">.</span>distanceAttenuation<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">float3</span> addLightSpecular <span class=\"token operator\">=</span> <span class=\"token function\">LightingSpecular</span><span class=\"token punctuation\">(</span>addLight<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> addLight<span class=\"token punctuation\">.</span>direction<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>viewDir<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> _Gloss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tc<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">+=</span> addLightResualt <span class=\"token operator\">+</span> addLightSpecular<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n<span class=\"token comment\">//Light.hlsl</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">GetAdditionalLightsCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// TODO : we need to expose in SRP api an ability for the pipeline cap the amount of lights</span>\n\t\t<span class=\"token comment\">// in the culling. This way we could do the loop branch with an uniform</span>\n\t\t<span class=\"token comment\">// This would be helpful to support baking exceeding lights in SH as well</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">min</span><span class=\"token punctuation\">(</span>_AdditionalLightsCount<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> unity_LightData<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Legacy에서는 추가로 라이트를 연산하려면 Forward Add 패스를 사용해야 했었기 때문에 많은 라이트 = 드로우콜 상승의 주범이 되었으나, URP에서는 이렇게 라이트들을 모두 얻어와서 for문으로 한 번에 처리 가능합니다.</li>\n<li>추가 라이트는 디렉셔널 라이트가 아닐수도 있으므로, <code class=\"language-text\">distanceAttenuation</code>을 곱해주어야 제대로 라이팅 처리가 가능합니다.</li>\n<li>위에서는 <code class=\"language-text\">Lighting Lambert</code>함수를 사용했지만, 메인 라이트에서 NPR계산을 해 주었다면 추가 라이트 또한 NPR 계산을 하는 것이 통일성에는 좋습니다. 하지만 적당히 어울리는 표현을 잘 선택하는 것이 중요합니다.</li>\n</ul>\n<p><strong>스펙큘러 / LightingSpecular</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"hlsl\"><pre class=\"language-hlsl\"><code class=\"language-hlsl\"><span class=\"token comment\">// frag()</span>\no<span class=\"token punctuation\">.</span>viewDir <span class=\"token operator\">=</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>_WorldSpaceCameraPos<span class=\"token punctuation\">.</span>xyz <span class=\"token operator\">-</span> o<span class=\"token punctuation\">.</span>worldPos<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">half3</span> viewDirWS <span class=\"token operator\">=</span> <span class=\"token function\">GetCameraPositionWS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> vertexInput<span class=\"token punctuation\">.</span>positionWS<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Lighting.hlsl</span>\n<span class=\"token keyword\">half3</span> <span class=\"token function\">LightingSpecular</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">half3</span> lightColor<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> lightDir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> normal<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half3</span> viewDir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half4</span> specular<span class=\"token punctuation\">,</span> <span class=\"token keyword\">half</span> smoothness<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float3</span> halfVec <span class=\"token operator\">=</span> <span class=\"token function\">SafeNormalize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>lightDir<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">float3</span><span class=\"token punctuation\">(</span>viewDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> NdotH <span class=\"token operator\">=</span> <span class=\"token function\">saturate</span><span class=\"token punctuation\">(</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>normal<span class=\"token punctuation\">,</span> halfVec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half</span> modifier <span class=\"token operator\">=</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>NdotH<span class=\"token punctuation\">,</span> smoothness<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">half3</span> specularReflection <span class=\"token operator\">=</span> specular<span class=\"token punctuation\">.</span>rgb <span class=\"token operator\">*</span> modifier<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> lightColor <span class=\"token operator\">*</span> specularReflection<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">NdotH</code>를 구해서 직접 구현해도 되지만 이 또한 <em>Lighting.hlsl</em>안에 포함되어있습니다.</li>\n<li>카메라월드포지션은 <code class=\"language-text\">GetCameraPositionWS()</code>로 구할수도 있습니다.</li>\n<li>간단한 블린퐁 방식으로 구현된 스펙쿨러</li>\n<li>인자 중에 <code class=\"language-text\">specular</code>라고 되어있는 것은 스펙큘러 마스킹 맵을 사용 (01:17:09)</li>\n</ul>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#urp-%EC%99%9C-%EC%8D%A8%EC%95%BC-%ED%95%A0%EA%B9%8C%EC%9A%94\">URP 왜 써야 할까요?</a></li>\n<li><a href=\"#%EC%85%B0%EC%9D%B4%EB%8D%94-%EC%A0%9C%EC%9E%91\">셰이더 제작</a></li>\n</ul>\n</div>","frontmatter":{"date":"August 27, 2022","title":"Dev Week - URP 셰이더 뜯어보기","categories":"STUDY","author":"JunHyeong Moon","emoji":""},"fields":{"slug":"/Study/Unity_DevWeekURP/"}},"site":{"siteMetadata":{"siteUrl":"https://junyangyee.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/Study/UnityCustomPbr/","nextSlug":"","prevSlug":"/Study/Unity_DevWeekURP/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}